###############################################################################
#                                                                             #
# IAR C/C++ Compiler V8.10.3.10338/W32 for 8051         28/May/2015  20:04:59 #
# Copyright 2004-2011 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#    Source file        =  E:\workproject\wireless-switch\demo\ZStack-CC2530- #
#                          2.3.0-1.4.0\Projects\zstack\Samples\SampleApp\Sour #
#                          ce\SampleApp.c                                     #
#    Command line       =  -f E:\workproject\wireless-switch\demo\ZStack-CC25 #
#                          30-2.3.0-1.4.0\Projects\zstack\Samples\SampleApp\C #
#                          C2530DB\..\..\..\Tools\CC2530DB\f8wCoord.cfg       #
#                          (-DCPU32MHZ -DROOT=__near_func                     #
#                          -DMAC_CFG_APP_PENDING_QUEUE=TRUE                   #
#                          -DZDO_COORDINATOR -DRTR_NWK -DBLINK_LEDS) -f       #
#                          E:\workproject\wireless-switch\demo\ZStack-CC2530- #
#                          2.3.0-1.4.0\Projects\zstack\Samples\SampleApp\CC25 #
#                          30DB\..\..\..\Tools\CC2530DB\f8wConfig.cfg         #
#                          (-DSECURE=0 -DZG_SECURE_DYNAMIC=0 -DREFLECTOR      #
#                          -DDEFAULT_CHANLIST=0x00000800                      #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFF1                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116 "-DCONST=const __code"    #
#                          -DGENERIC=__generic -DRFD_RCVC_ALWAYS_ON=FALSE     #
#                          -DPOLL_RATE=1000 -DQUEUED_POLL_RATE=100            #
#                          -DRESPONSE_POLL_RATE=100) -DREJOIN_POLL_RATE=440   #
#                          E:\workproject\wireless-switch\demo\ZStack-CC2530- #
#                          2.3.0-1.4.0\Projects\zstack\Samples\SampleApp\Sour #
#                          ce\SampleApp.c -D ZIGBEEPRO -D ZTOOL_P1 -D         #
#                          xMT_TASK -D xMT_SYS_FUNC -D xMT_ZDO_FUNC -D        #
#                          LCD_SUPPORTED=DEBUG -D COORDINATOR_ME -lC          #
#                          E:\workproject\wireless-switch\demo\ZStack-CC2530- #
#                          2.3.0-1.4.0\Projects\zstack\Samples\SampleApp\CC25 #
#                          30DB\CoordinatorEB-Pro\List\ -lA                   #
#                          E:\workproject\wireless-switch\demo\ZStack-CC2530- #
#                          2.3.0-1.4.0\Projects\zstack\Samples\SampleApp\CC25 #
#                          30DB\CoordinatorEB-Pro\List\ --diag_suppress       #
#                          Pe001,Pa010 -o E:\workproject\wireless-switch\demo #
#                          \ZStack-CC2530-2.3.0-1.4.0\Projects\zstack\Samples #
#                          \SampleApp\CC2530DB\CoordinatorEB-Pro\Obj\ -e      #
#                          --no_unroll --no_inline --no_tbaa --debug          #
#                          --core=plain --dptr=16,1 --data_model=large        #
#                          --code_model=banked --calling_convention=xdata_ree #
#                          ntrant --place_constants=data_rom                  #
#                          --nr_virtual_regs 16 -I E:\workproject\wireless-sw #
#                          itch\demo\ZStack-CC2530-2.3.0-1.4.0\Projects\zstac #
#                          k\Samples\SampleApp\CC2530DB\ -I                   #
#                          E:\workproject\wireless-switch\demo\ZStack-CC2530- #
#                          2.3.0-1.4.0\Projects\zstack\Samples\SampleApp\CC25 #
#                          30DB\..\SOURCE\ -I E:\workproject\wireless-switch\ #
#                          demo\ZStack-CC2530-2.3.0-1.4.0\Projects\zstack\Sam #
#                          ples\SampleApp\CC2530DB\..\..\..\ZMAIN\TI2530DB\   #
#                          -I E:\workproject\wireless-switch\demo\ZStack-CC25 #
#                          30-2.3.0-1.4.0\Projects\zstack\Samples\SampleApp\C #
#                          C2530DB\..\..\..\..\..\COMPONENTS\MT\ -I           #
#                          E:\workproject\wireless-switch\demo\ZStack-CC2530- #
#                          2.3.0-1.4.0\Projects\zstack\Samples\SampleApp\CC25 #
#                          30DB\..\..\..\..\..\COMPONENTS\HAL\INCLUDE\ -I     #
#                          E:\workproject\wireless-switch\demo\ZStack-CC2530- #
#                          2.3.0-1.4.0\Projects\zstack\Samples\SampleApp\CC25 #
#                          30DB\..\..\..\..\..\COMPONENTS\HAL\TARGET\CC2530EB #
#                          \ -I E:\workproject\wireless-switch\demo\ZStack-CC #
#                          2530-2.3.0-1.4.0\Projects\zstack\Samples\SampleApp #
#                          \CC2530DB\..\..\..\..\..\COMPONENTS\OSAL\MCU\CCSOC #
#                          \ -I E:\workproject\wireless-switch\demo\ZStack-CC #
#                          2530-2.3.0-1.4.0\Projects\zstack\Samples\SampleApp #
#                          \CC2530DB\..\..\..\..\..\COMPONENTS\OSAL\INCLUDE\  #
#                          -I E:\workproject\wireless-switch\demo\ZStack-CC25 #
#                          30-2.3.0-1.4.0\Projects\zstack\Samples\SampleApp\C #
#                          C2530DB\..\..\..\..\..\COMPONENTS\STACK\AF\ -I     #
#                          E:\workproject\wireless-switch\demo\ZStack-CC2530- #
#                          2.3.0-1.4.0\Projects\zstack\Samples\SampleApp\CC25 #
#                          30DB\..\..\..\..\..\COMPONENTS\STACK\NWK\ -I       #
#                          E:\workproject\wireless-switch\demo\ZStack-CC2530- #
#                          2.3.0-1.4.0\Projects\zstack\Samples\SampleApp\CC25 #
#                          30DB\..\..\..\..\..\COMPONENTS\STACK\SEC\ -I       #
#                          E:\workproject\wireless-switch\demo\ZStack-CC2530- #
#                          2.3.0-1.4.0\Projects\zstack\Samples\SampleApp\CC25 #
#                          30DB\..\..\..\..\..\COMPONENTS\STACK\SAPI\ -I      #
#                          E:\workproject\wireless-switch\demo\ZStack-CC2530- #
#                          2.3.0-1.4.0\Projects\zstack\Samples\SampleApp\CC25 #
#                          30DB\..\..\..\..\..\COMPONENTS\STACK\SYS\ -I       #
#                          E:\workproject\wireless-switch\demo\ZStack-CC2530- #
#                          2.3.0-1.4.0\Projects\zstack\Samples\SampleApp\CC25 #
#                          30DB\..\..\..\..\..\COMPONENTS\STACK\ZDO\ -I       #
#                          E:\workproject\wireless-switch\demo\ZStack-CC2530- #
#                          2.3.0-1.4.0\Projects\zstack\Samples\SampleApp\CC25 #
#                          30DB\..\..\..\..\..\COMPONENTS\ZMAC\F8W\ -I        #
#                          E:\workproject\wireless-switch\demo\ZStack-CC2530- #
#                          2.3.0-1.4.0\Projects\zstack\Samples\SampleApp\CC25 #
#                          30DB\..\..\..\..\..\COMPONENTS\ZMAC\ -I            #
#                          E:\workproject\wireless-switch\demo\ZStack-CC2530- #
#                          2.3.0-1.4.0\Projects\zstack\Samples\SampleApp\CC25 #
#                          30DB\..\..\..\..\..\COMPONENTS\SERVICES\SADDR\ -I  #
#                          E:\workproject\wireless-switch\demo\ZStack-CC2530- #
#                          2.3.0-1.4.0\Projects\zstack\Samples\SampleApp\CC25 #
#                          30DB\..\..\..\..\..\COMPONENTS\SERVICES\SDATA\ -I  #
#                          E:\workproject\wireless-switch\demo\ZStack-CC2530- #
#                          2.3.0-1.4.0\Projects\zstack\Samples\SampleApp\CC25 #
#                          30DB\..\..\..\..\..\COMPONENTS\MAC\INCLUDE\ -I     #
#                          E:\workproject\wireless-switch\demo\ZStack-CC2530- #
#                          2.3.0-1.4.0\Projects\zstack\Samples\SampleApp\CC25 #
#                          30DB\..\..\..\..\..\COMPONENTS\MAC\HIGH_LEVEL\ -I  #
#                          E:\workproject\wireless-switch\demo\ZStack-CC2530- #
#                          2.3.0-1.4.0\Projects\zstack\Samples\SampleApp\CC25 #
#                          30DB\..\..\..\..\..\COMPONENTS\MAC\LOW_LEVEL\srf04 #
#                          \ -I E:\workproject\wireless-switch\demo\ZStack-CC #
#                          2530-2.3.0-1.4.0\Projects\zstack\Samples\SampleApp #
#                          \CC2530DB\..\..\..\..\..\COMPONENTS\MAC\LOW_LEVEL\ #
#                          srf04\SINGLE_CHIP\ -Om --require_prototypes        #
#    List file          =  E:\workproject\wireless-switch\demo\ZStack-CC2530- #
#                          2.3.0-1.4.0\Projects\zstack\Samples\SampleApp\CC25 #
#                          30DB\CoordinatorEB-Pro\List\SampleApp.lst          #
#    Object file        =  E:\workproject\wireless-switch\demo\ZStack-CC2530- #
#                          2.3.0-1.4.0\Projects\zstack\Samples\SampleApp\CC25 #
#                          30DB\CoordinatorEB-Pro\Obj\SampleApp.r51           #
#                                                                             #
#                                                                             #
###############################################################################

E:\workproject\wireless-switch\demo\ZStack-CC2530-2.3.0-1.4.0\Projects\zstack\Samples\SampleApp\Source\SampleApp.c
      1          /**************************************************************************************************
      2            Filename:       SampleApp.c
      3            Revised:        $Date: 2009-03-18 15:56:27 -0700 (Wed, 18 Mar 2009) $
      4            Revision:       $Revision: 19453 $
      5          
      6            Description:    Sample Application (no Profile).
      7          
      8          
      9            Copyright 2007 Texas Instruments Incorporated. All rights reserved.
     10          
     11            IMPORTANT: Your use of this Software is limited to those specific rights
     12            granted under the terms of a software license agreement between the user
     13            who downloaded the software, his/her employer (which must be your employer)
     14            and Texas Instruments Incorporated (the "License").  You may not use this
     15            Software unless you agree to abide by the terms of the License. The License
     16            limits your use, and you acknowledge, that the Software may not be modified,
     17            copied or distributed unless embedded on a Texas Instruments microcontroller
     18            or used solely and exclusively in conjunction with a Texas Instruments radio
     19            frequency transceiver, which is integrated into your product.  Other than for
     20            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     21            works of, modify, distribute, perform, display or sell this Software and/or
     22            its documentation for any purpose.
     23          
     24            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     25            PROVIDED AS IS?WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
     26            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
     27            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     28            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     29            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     30            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     31            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     32            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     33            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     34            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     35          
     36            Should you have any questions regarding your right to use this Software,
     37            contact Texas Instruments Incorporated at www.TI.com.
     38          **************************************************************************************************/
     39          
     40          /*********************************************************************
     41            This application isn't intended to do anything useful, it is
     42            intended to be a simple example of an application's structure.
     43          
     44            This application sends it's messages either as broadcast or
     45            broadcast filtered group messages.  The other (more normal)
     46            message addressing is unicast.  Most of the other sample
     47            applications are written to support the unicast message model.
     48          
     49            Key control:
     50              SW1:  Sends a flash command to all devices in Group 1.
     51              SW2:  Adds/Removes (toggles) this device in and out
     52                    of Group 1.  This will enable and disable the
     53                    reception of the flash command.
     54          *********************************************************************/
     55          
     56          /*********************************************************************
     57           * INCLUDES
     58           */
     59          #include "OSAL.h"
     60          #include "ZGlobals.h"
     61          #include "AF.h"
     62          #include "aps_groups.h"
     63          #include "ZDApp.h"
     64          
     65          #include "SampleApp.h"
     66          #include "SampleAppHw.h"
     67          
     68          #include "OnBoard.h"
     69          #include "Hal_flash.h"
     70          /* HAL */
     71          #include "hal_lcd.h"
     72          #include "hal_led.h"
     73          #include "hal_key.h"
     74          #include "MT_UART.h"
     75          #include "MT_APP.h"
     76          #include "MT.h"
     77          #include "OSAL_Nv.h"
     78          #include <string.h>
     79          #include "zigbee_wrt_protocol.h"
     80          
     81          #define TEST_NV 0x0202
     82          
     83          /*********************************************************************
     84           * MACROS
     85           */
     86          
     87          /*********************************************************************
     88           * CONSTANTS
     89           */
     90          
     91          /*********************************************************************
     92           * TYPEDEFS
     93           */
     94          
     95          /*********************************************************************
     96           * GLOBAL VARIABLES
     97           */
     98          int  init_from_flash(void);
     99          void   Set_Zgb_param(Msg_WRT_Zg_Set_Get_info *pinfo);
    100          void  Get_Zgb_param(void);
    101          uint8 Calc_CRC8(uint8 *PData, uint32 Len);
    102          // This list should be filled with Application specific Cluster IDs.

   \                                 In  segment XDATA_ROM_C, align 1
    103          const cId_t SampleApp_ClusterList[SAMPLEAPP_MAX_CLUSTERS] =
   \                     SampleApp_ClusterList:
   \   000000   0100         DW 1
   \   000002   0200         DW 2
    104          {
    105            SAMPLEAPP_PERIODIC_CLUSTERID,
    106            SAMPLEAPP_FLASH_CLUSTERID
    107          };
    108          

   \                                 In  segment XDATA_I, align 1, keep-with-next
    109          SimpleDescriptionFormat_t SampleApp_SimpleDesc =
   \                     SampleApp_SimpleDesc:
   \   000000                DS 12
   \   00000C                REQUIRE `?<Initializer for SampleApp_SimpleDesc>`
   \   00000C                REQUIRE __INIT_XDATA_I
    110          {
    111            SAMPLEAPP_ENDPOINT,              //  int Endpoint;
    112            SAMPLEAPP_PROFID,                //  uint16 AppProfId[2];
    113            SAMPLEAPP_DEVICEID,              //  uint16 AppDeviceId[2];
    114            SAMPLEAPP_DEVICE_VERSION,        //  int   AppDevVer:4;
    115            SAMPLEAPP_FLAGS,                 //  int   AppFlags:4;
    116            SAMPLEAPP_MAX_CLUSTERS,          //  uint8  AppNumInClusters;
    117            (cId_t *)SampleApp_ClusterList,  //  uint8 *pAppInClusterList;
    118            SAMPLEAPP_MAX_CLUSTERS,          //  uint8  AppNumInClusters;
    119            (cId_t *)SampleApp_ClusterList   //  uint8 *pAppInClusterList;
    120          };
    121          
    122          // This is the Endpoint/Interface description.  It is defined here, but
    123          // filled-in in SampleApp_Init().  Another way to go would be to fill
    124          // in the structure here and make it a "const" (in code space).  The
    125          // way it's defined in this sample app it is define in RAM.

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    126          endPointDesc_t SampleApp_epDesc;
   \                     SampleApp_epDesc:
   \   000000                DS 6
   \   000006                REQUIRE __INIT_XDATA_Z
    127          
    128          /*********************************************************************
    129           * EXTERNAL VARIABLES
    130           */
    131          
    132          /*********************************************************************
    133           * EXTERNAL FUNCTIONS
    134           */
    135          
    136          /*********************************************************************
    137           * LOCAL VARIABLES
    138           */

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    139          uint8 SampleApp_TaskID;   // Task ID for internal task/event processing
   \                     SampleApp_TaskID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    140                                    // This variable will be received when
    141                                    // SampleApp_Init() is called.

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    142          devStates_t SampleApp_NwkState;
   \                     SampleApp_NwkState:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    143          
    144          //uint8 SampleApp_TransID;  // This is the unique message ID (counter)

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    145          uint8 globa_run_num = 0;
   \                     globa_run_num:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    146          
    147          //afAddrType_t SampleApp_Periodic_DstAddr;
    148          //afAddrType_t SampleApp_Flash_DstAddr;
    149          //afAddrType_t SampleApp_P2P_DstAddr;
    150          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    151          aps_Group_t SampleApp_Group;
   \                     SampleApp_Group:
   \   000000                DS 18
   \   000012                REQUIRE __INIT_XDATA_Z
    152          
    153          //uint8 SampleAppPeriodicCounter = 0;
    154          //uint8 SampleAppFlashCounter = 0;

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    155          uint8 uart_data_buffer[50];
   \                     uart_data_buffer:
   \   000000                DS 50
   \   000032                REQUIRE __INIT_XDATA_Z
    156          
    157          //static  uint8     user_endpoint;//端口
    158          //static  uint16    user_profile_id;//应用工程id 两个zigbee要一样才可以通讯
    159          //static  uint16    user_panid;
    160          
    161          /*********************************************************************
    162           * LOCAL FUNCTIONS
    163           */
    164          void SampleApp_HandleKeys( uint8 shift, uint8 keys );
    165          void SampleApp_MessageMSGCB( afIncomingMSGPacket_t *pckt );
    166          void SampleApp_SendPeriodicMessage( void );
    167          void SampleApp_SendFlashMessage( uint16 flashTime );
    168          void  AF_To_R_From_C(afAddrType_t *srcAddr,char *pdata, uint16 len);
    169          int  pack_msg_ack_param(Msg_WRT_Zg_Set_Get_info *mzwt, char *pout);
    170          
    171          /*********************************************************************
    172           * NETWORK LAYER CALLBACKS
    173           */
    174          
    175          
    176          /*********************************************************************
    177           * PUBLIC FUNCTIONS
    178           */
    179          

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    180          void  AF_To_R_From_C(afAddrType_t *srcAddr,char *pdata, uint16 len)
   \                     AF_To_R_From_C:
    181          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
   \   000005   740C         MOV     A,#0xc
   \   000007   12....       LCALL   ?XSTACK_DISP0_8
   \   00000A   E0           MOVX    A,@DPTR
   \   00000B   F5..         MOV     ?V0 + 2,A
   \   00000D   A3           INC     DPTR
   \   00000E   E0           MOVX    A,@DPTR
   \   00000F   F5..         MOV     ?V0 + 3,A
    182          	if ( AF_DataRequest( srcAddr, &SampleApp_epDesc,
    183          						 3,	/*cluster ID  没有处理*/					
    184          						 len,
    185          						 (uint8 *)pdata,
    186          						 &globa_run_num,
    187          						 AF_DISCV_ROUTE,
    188          						 AF_DEFAULT_RADIUS ) == afStatus_SUCCESS )
   \   000011                ; Setup parameters for call to function AF_DataRequest
   \   000011   75..1E       MOV     ?V0 + 0,#0x1e
   \   000014   78..         MOV     R0,#?V0 + 0
   \   000016   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000019   75....       MOV     ?V0 + 0,#globa_run_num & 0xff
   \   00001C   75....       MOV     ?V0 + 1,#(globa_run_num >> 8) & 0xff
   \   00001F   78..         MOV     R0,#?V0 + 0
   \   000021   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000024   8C..         MOV     ?V0 + 0,R4
   \   000026   8D..         MOV     ?V0 + 1,R5
   \   000028   78..         MOV     R0,#?V0 + 0
   \   00002A   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00002D   78..         MOV     R0,#?V0 + 2
   \   00002F   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000032   75..03       MOV     ?V0 + 0,#0x3
   \   000035   75..00       MOV     ?V0 + 1,#0x0
   \   000038   78..         MOV     R0,#?V0 + 0
   \   00003A   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00003D   7920         MOV     R1,#0x20
   \   00003F   7C..         MOV     R4,#SampleApp_epDesc & 0xff
   \   000041   7D..         MOV     R5,#(SampleApp_epDesc >> 8) & 0xff
   \   000043   12....       LCALL   ??AF_DataRequest?relay
   \   000046   7409         MOV     A,#0x9
   \   000048   12....       LCALL   ?DEALLOC_XSTACK8
   \   00004B   E9           MOV     A,R1
   \   00004C   700D         JNZ     ??AF_To_R_From_C_0
    189          	{
    190          		HalLedBlink(HAL_LED_2, 2, 50, 1000);
   \   00004E                ; Setup parameters for call to function HalLedBlink
   \   00004E   7CE8         MOV     R4,#-0x18
   \   000050   7D03         MOV     R5,#0x3
   \   000052   7B32         MOV     R3,#0x32
   \   000054   7A02         MOV     R2,#0x2
   \   000056   7902         MOV     R1,#0x2
   \   000058   12....       LCALL   ??HalLedBlink?relay
    191          	}
    192          	else
    193          	{
    194          	  // Error occurred in request to send.
    195          	}
    196          }
   \                     ??AF_To_R_From_C_0:
   \   00005B   7F04         MOV     R7,#0x4
   \   00005D   02....       LJMP    ?BANKED_LEAVE_XDATA
    197          
    198          
    199          

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    200          void   Set_Zgb_param(Msg_WRT_Zg_Set_Get_info *pinfo)
   \                     Set_Zgb_param:
    201          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 6
   \   000005   74FA         MOV     A,#-0x6
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
    202          	uint8   tempbuf[6];
    203          	
    204          	tempbuf[0] = pinfo->panid;
   \   00000A   8A82         MOV     DPL,R2
   \   00000C   8B83         MOV     DPH,R3
   \   00000E   E0           MOVX    A,@DPTR
   \   00000F   85..82       MOV     DPL,?XSP + 0
   \   000012   85..83       MOV     DPH,?XSP + 1
   \   000015   F0           MOVX    @DPTR,A
    205          	tempbuf[1] = pinfo->panid >> 8;
   \   000016   8A82         MOV     DPL,R2
   \   000018   8B83         MOV     DPH,R3
   \   00001A   A3           INC     DPTR
   \   00001B   E0           MOVX    A,@DPTR
   \   00001C   C0E0         PUSH    A
   \   00001E   7401         MOV     A,#0x1
   \   000020   12....       LCALL   ?XSTACK_DISP0_8
   \   000023   D0E0         POP     A
   \   000025   F0           MOVX    @DPTR,A
    206          
    207          	tempbuf[2] = pinfo->profileid;
   \   000026   EA           MOV     A,R2
   \   000027   2402         ADD     A,#0x2
   \   000029   F8           MOV     R0,A
   \   00002A   EB           MOV     A,R3
   \   00002B   3400         ADDC    A,#0x0
   \   00002D   F9           MOV     R1,A
   \   00002E   8882         MOV     DPL,R0
   \   000030   8983         MOV     DPH,R1
   \   000032   E0           MOVX    A,@DPTR
   \   000033   C0E0         PUSH    A
   \   000035   7402         MOV     A,#0x2
   \   000037   12....       LCALL   ?XSTACK_DISP0_8
   \   00003A   D0E0         POP     A
   \   00003C   F0           MOVX    @DPTR,A
    208          	tempbuf[3] = pinfo->profileid >> 8;
   \   00003D   8882         MOV     DPL,R0
   \   00003F   8983         MOV     DPH,R1
   \   000041   A3           INC     DPTR
   \   000042   E0           MOVX    A,@DPTR
   \   000043   C0E0         PUSH    A
   \   000045   7403         MOV     A,#0x3
   \   000047   12....       LCALL   ?XSTACK_DISP0_8
   \   00004A   D0E0         POP     A
   \   00004C   F0           MOVX    @DPTR,A
    209          
    210          	tempbuf[4] = pinfo->endpoint;
   \   00004D   8A82         MOV     DPL,R2
   \   00004F   8B83         MOV     DPH,R3
   \   000051   A3           INC     DPTR
   \   000052   A3           INC     DPTR
   \   000053   A3           INC     DPTR
   \   000054   A3           INC     DPTR
   \   000055   E0           MOVX    A,@DPTR
   \   000056   C0E0         PUSH    A
   \   000058   7404         MOV     A,#0x4
   \   00005A   12....       LCALL   ?XSTACK_DISP0_8
   \   00005D   D0E0         POP     A
   \   00005F   F0           MOVX    @DPTR,A
    211          
    212          	
    213          	if ( osal_nv_item_init(PANID_PROFILE_ENDPOINT_ADDR, 5, NULL) == ZSUCCESS)
   \   000060                ; Setup parameters for call to function osal_nv_item_init
   \   000060   E4           CLR     A
   \   000061   F5..         MOV     ?V0 + 0,A
   \   000063   F5..         MOV     ?V0 + 1,A
   \   000065   78..         MOV     R0,#?V0 + 0
   \   000067   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00006A   7C05         MOV     R4,#0x5
   \   00006C   7D00         MOV     R5,#0x0
   \   00006E   7A02         MOV     R2,#0x2
   \   000070   7B02         MOV     R3,#0x2
   \   000072   12....       LCALL   ??osal_nv_item_init?relay
   \   000075   7402         MOV     A,#0x2
   \   000077   12....       LCALL   ?DEALLOC_XSTACK8
   \   00007A   E9           MOV     A,R1
   \   00007B   702C         JNZ     ??Set_Zgb_param_0
    214          	{
    215          		if(osal_nv_write(PANID_PROFILE_ENDPOINT_ADDR,0, 5, tempbuf) == ZSUCCESS)
   \   00007D                ; Setup parameters for call to function osal_nv_write
   \   00007D   85..82       MOV     DPL,?XSP + 0
   \   000080   85..83       MOV     DPH,?XSP + 1
   \   000083   8582..       MOV     ?V0 + 0,DPL
   \   000086   8583..       MOV     ?V0 + 1,DPH
   \   000089   78..         MOV     R0,#?V0 + 0
   \   00008B   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00008E   75..05       MOV     ?V0 + 0,#0x5
   \   000091   75..00       MOV     ?V0 + 1,#0x0
   \   000094   78..         MOV     R0,#?V0 + 0
   \   000096   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000099   7C00         MOV     R4,#0x0
   \   00009B   7D00         MOV     R5,#0x0
   \   00009D   7A02         MOV     R2,#0x2
   \   00009F   7B02         MOV     R3,#0x2
   \   0000A1   12....       LCALL   ??osal_nv_write?relay
   \   0000A4   7404         MOV     A,#0x4
   \   0000A6   12....       LCALL   ?DEALLOC_XSTACK8
    216          		{
    217          			//ack
    218          		}	    
    219          	}
    220          
    221          }
   \                     ??Set_Zgb_param_0:
   \   0000A9   7406         MOV     A,#0x6
   \   0000AB   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000AE   7F02         MOV     R7,#0x2
   \   0000B0   02....       LJMP    ?BANKED_LEAVE_XDATA
    222          // return wrt zgb param

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    223          void  Get_Zgb_param(void)
   \                     Get_Zgb_param:
    224          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 17
   \   000005   74EF         MOV     A,#-0x11
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
    225          	Msg_WRT_Zg_Set_Get_info param;
    226          	uint16  datalen;
    227          	uint8   tempbuf[6];
    228              osal_memset(tempbuf,0,6);
   \   00000A                ; Setup parameters for call to function osal_memset
   \   00000A   7C06         MOV     R4,#0x6
   \   00000C   7D00         MOV     R5,#0x0
   \   00000E   7900         MOV     R1,#0x0
   \   000010   85..82       MOV     DPL,?XSP + 0
   \   000013   85..83       MOV     DPH,?XSP + 1
   \   000016   AA82         MOV     R2,DPL
   \   000018   AB83         MOV     R3,DPH
   \   00001A   12....       LCALL   ??osal_memset?relay
    229          	 
    230          	if(osal_nv_read(PANID_PROFILE_ENDPOINT_ADDR,0, 6, &tempbuf) == ZSUCCESS)
   \   00001D                ; Setup parameters for call to function osal_nv_read
   \   00001D   85..82       MOV     DPL,?XSP + 0
   \   000020   85..83       MOV     DPH,?XSP + 1
   \   000023   8582..       MOV     ?V0 + 0,DPL
   \   000026   8583..       MOV     ?V0 + 1,DPH
   \   000029   78..         MOV     R0,#?V0 + 0
   \   00002B   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00002E   75..06       MOV     ?V0 + 0,#0x6
   \   000031   75..00       MOV     ?V0 + 1,#0x0
   \   000034   78..         MOV     R0,#?V0 + 0
   \   000036   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000039   7C00         MOV     R4,#0x0
   \   00003B   7D00         MOV     R5,#0x0
   \   00003D   7A02         MOV     R2,#0x2
   \   00003F   7B02         MOV     R3,#0x2
   \   000041   12....       LCALL   ??osal_nv_read?relay
   \   000044   7404         MOV     A,#0x4
   \   000046   12....       LCALL   ?DEALLOC_XSTACK8
   \   000049   E9           MOV     A,R1
   \   00004A   7066         JNZ     ??Get_Zgb_param_0
    231          	{
    232          		param.panid = tempbuf[0] + (tempbuf[1]<<8);
   \   00004C   85..82       MOV     DPL,?XSP + 0
   \   00004F   85..83       MOV     DPH,?XSP + 1
   \   000052   E0           MOVX    A,@DPTR
   \   000053   FA           MOV     R2,A
   \   000054   7401         MOV     A,#0x1
   \   000056   12....       LCALL   ?XSTACK_DISP0_8
   \   000059   E0           MOVX    A,@DPTR
   \   00005A   F9           MOV     R1,A
   \   00005B   EA           MOV     A,R2
   \   00005C   F8           MOV     R0,A
   \   00005D   7406         MOV     A,#0x6
   \   00005F   12....       LCALL   ?XSTACK_DISP0_8
   \   000062   E8           MOV     A,R0
   \   000063   F0           MOVX    @DPTR,A
   \   000064   A3           INC     DPTR
   \   000065   E9           MOV     A,R1
   \   000066   F0           MOVX    @DPTR,A
    233          		param.profileid = tempbuf[2] + (tempbuf[3]<<8);
   \   000067   7402         MOV     A,#0x2
   \   000069   12....       LCALL   ?XSTACK_DISP0_8
   \   00006C   E0           MOVX    A,@DPTR
   \   00006D   FA           MOV     R2,A
   \   00006E   7403         MOV     A,#0x3
   \   000070   12....       LCALL   ?XSTACK_DISP0_8
   \   000073   E0           MOVX    A,@DPTR
   \   000074   F9           MOV     R1,A
   \   000075   EA           MOV     A,R2
   \   000076   F8           MOV     R0,A
   \   000077   7408         MOV     A,#0x8
   \   000079   12....       LCALL   ?XSTACK_DISP0_8
   \   00007C   E8           MOV     A,R0
   \   00007D   F0           MOVX    @DPTR,A
   \   00007E   A3           INC     DPTR
   \   00007F   E9           MOV     A,R1
   \   000080   F0           MOVX    @DPTR,A
    234          		param.endpoint = tempbuf[4];	
   \   000081   7404         MOV     A,#0x4
   \   000083   12....       LCALL   ?XSTACK_DISP0_8
   \   000086   E0           MOVX    A,@DPTR
   \   000087   C0E0         PUSH    A
   \   000089   740A         MOV     A,#0xa
   \   00008B   12....       LCALL   ?XSTACK_DISP0_8
   \   00008E   D0E0         POP     A
   \   000090   F0           MOVX    @DPTR,A
    235          		
    236          		datalen = pack_msg_ack_param(&param,  (char*)uart_data_buffer);
   \   000091                ; Setup parameters for call to function pack_msg_ack_param
   \   000091   7C..         MOV     R4,#uart_data_buffer & 0xff
   \   000093   7D..         MOV     R5,#(uart_data_buffer >> 8) & 0xff
   \   000095   7406         MOV     A,#0x6
   \   000097   12....       LCALL   ?XSTACK_DISP0_8
   \   00009A   AA82         MOV     R2,DPL
   \   00009C   AB83         MOV     R3,DPH
   \   00009E   12....       LCALL   ??pack_msg_ack_param?relay
   \   0000A1   8A..         MOV     ?V0 + 0,R2
   \   0000A3   8B..         MOV     ?V0 + 1,R3
   \   0000A5   AC..         MOV     R4,?V0 + 0
   \   0000A7   AD..         MOV     R5,?V0 + 1
    237          		HalUARTWrite(0, uart_data_buffer, datalen);
   \   0000A9                ; Setup parameters for call to function HalUARTWrite
   \   0000A9   7A..         MOV     R2,#uart_data_buffer & 0xff
   \   0000AB   7B..         MOV     R3,#(uart_data_buffer >> 8) & 0xff
   \   0000AD   7900         MOV     R1,#0x0
   \   0000AF   12....       LCALL   ??HalUARTWrite?relay
    238          	}			
    239          }
   \                     ??Get_Zgb_param_0:
   \   0000B2   7411         MOV     A,#0x11
   \   0000B4   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000B7   7F02         MOV     R7,#0x2
   \   0000B9   02....       LJMP    ?BANKED_LEAVE_XDATA
    240          

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    241          static void SerialApp_CallBack(uint8 port, uint8 event)
   \                     SerialApp_CallBack:
    242          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
    243            if ((event & (HAL_UART_RX_FULL | HAL_UART_RX_ABOUT_FULL | HAL_UART_RX_TIMEOUT)))
   \   000007   7407         MOV     A,#0x7
   \   000009   5E           ANL     A,R6
   \   00000A   7003         JNZ     $+5
   \   00000C   02....       LJMP    ??SerialApp_CallBack_0 & 0xFFFF
    244             {
    245                 // HalUARTRead(SERIAL_APP_PORT, SerialApp_TxBuf+SerialApp_TxLen+1,
    246                  //                                            SERIAL_APP_TX_MAX-SerialApp_TxLen);	
    247                  
    248          	  uint8 crc_t; 
    249                uint8 *data;
    250                Zg_Header_Struct *ph;
    251                Msg_Zg_WRT_transfer *mzwt;
    252          //	  HalLedSet(HAL_LED_2, HAL_LED_MODE_TOGGLE);
    253                HalUARTRead(0, uart_data_buffer,sizeof(uart_data_buffer));
   \   00000F                ; Setup parameters for call to function HalUARTRead
   \   00000F   7C32         MOV     R4,#0x32
   \   000011   7D00         MOV     R5,#0x0
   \   000013   7A..         MOV     R2,#uart_data_buffer & 0xff
   \   000015   7B..         MOV     R3,#(uart_data_buffer >> 8) & 0xff
   \   000017   7900         MOV     R1,#0x0
   \   000019   12....       LCALL   ??HalUARTRead?relay
    254          	  ph  = (Zg_Header_Struct *)uart_data_buffer;
    255          	  crc_t = Calc_CRC8(uart_data_buffer + sizeof(Zg_Header_Struct), ph->msg_len);
   \   00001C                ; Setup parameters for call to function Calc_CRC8
   \   00001C   90....       MOV     DPTR,#uart_data_buffer + 5
   \   00001F   E0           MOVX    A,@DPTR
   \   000020   F5..         MOV     ?V0 + 0,A
   \   000022   A3           INC     DPTR
   \   000023   E0           MOVX    A,@DPTR
   \   000024   F5..         MOV     ?V0 + 1,A
   \   000026   E4           CLR     A
   \   000027   F5..         MOV     ?V0 + 2,A
   \   000029   F5..         MOV     ?V0 + 3,A
   \   00002B   78..         MOV     R0,#?V0 + 0
   \   00002D   12....       LCALL   ?PUSH_XSTACK_I_FOUR
   \   000030   7A..         MOV     R2,#(uart_data_buffer + 8) & 0xff
   \   000032   7B..         MOV     R3,#((uart_data_buffer + 8) >> 8) & 0xff
   \   000034   12....       LCALL   ??Calc_CRC8?relay
   \   000037   7404         MOV     A,#0x4
   \   000039   12....       LCALL   ?DEALLOC_XSTACK8
   \   00003C   E9           MOV     A,R1
   \   00003D   F8           MOV     R0,A
    256          	 
    257          	 if(ph->crc8 == crc_t)
   \   00003E   90....       MOV     DPTR,#uart_data_buffer + 7
   \   000041   E0           MOVX    A,@DPTR
   \   000042   68           XRL     A,R0
   \   000043   704B         JNZ     ??SerialApp_CallBack_0
    258          	 {
    259          		switch(ph->msg_cmd)
   \   000045   90....       MOV     DPTR,#uart_data_buffer + 3
   \   000048   E0           MOVX    A,@DPTR
   \   000049   F5..         MOV     ?V0 + 0,A
   \   00004B   A3           INC     DPTR
   \   00004C   E0           MOVX    A,@DPTR
   \   00004D   F5..         MOV     ?V0 + 1,A
   \   00004F   78..         MOV     R0,#?V0 + 0
   \   000051   12....       LCALL   ?US_SWITCH_DENSE
   \                     `?<Jumptable for SerialApp_CallBack>_0`:
   \   000054   0280         DW        32770
   \   000056   02           DB        2
   \   000057   ....         DW        ??SerialApp_CallBack_0
   \   000059   ....         DW        ??SerialApp_CallBack_1
   \   00005B   ....         DW        ??SerialApp_CallBack_2
   \   00005D   ....         DW        ??SerialApp_CallBack_3
    260          		{
    261          			case WRT_ZGB_DATA_CMD:
    262          				mzwt = (Msg_Zg_WRT_transfer *)(uart_data_buffer + sizeof(Zg_Header_Struct));
    263                          data = (uint8 *)(uart_data_buffer + sizeof(Zg_Header_Struct) +sizeof(Msg_Zg_WRT_transfer));			
    264          				AF_To_R_From_C(&mzwt->end_dev_addr,(char*)data, ph->msg_len - sizeof(Msg_Zg_WRT_transfer));
   \                     ??SerialApp_CallBack_1:
   \   00005F                ; Setup parameters for call to function AF_To_R_From_C
   \   00005F   90....       MOV     DPTR,#uart_data_buffer + 5
   \   000062   E0           MOVX    A,@DPTR
   \   000063   24F1         ADD     A,#-0xf
   \   000065   F5..         MOV     ?V0 + 0,A
   \   000067   A3           INC     DPTR
   \   000068   E0           MOVX    A,@DPTR
   \   000069   34FF         ADDC    A,#-0x1
   \   00006B   F5..         MOV     ?V0 + 1,A
   \   00006D   78..         MOV     R0,#?V0 + 0
   \   00006F   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000072   7C..         MOV     R4,#(uart_data_buffer + 23) & 0xff
   \   000074   7D..         MOV     R5,#((uart_data_buffer + 23) >> 8) & 0xff
   \   000076   7A..         MOV     R2,#(uart_data_buffer + 9) & 0xff
   \   000078   7B..         MOV     R3,#((uart_data_buffer + 9) >> 8) & 0xff
   \   00007A   12....       LCALL   ??AF_To_R_From_C?relay
   \   00007D   7402         MOV     A,#0x2
   \   00007F   12....       LCALL   ?DEALLOC_XSTACK8
    265          				break;
   \   000082   800C         SJMP    ??SerialApp_CallBack_0
    266          
    267          			case WRT_ZGB_SET_INFO_CMD:
    268          				Set_Zgb_param((Msg_WRT_Zg_Set_Get_info *)(uart_data_buffer + sizeof(Zg_Header_Struct)));
   \                     ??SerialApp_CallBack_2:
   \   000084                ; Setup parameters for call to function Set_Zgb_param
   \   000084   7A..         MOV     R2,#(uart_data_buffer + 8) & 0xff
   \   000086   7B..         MOV     R3,#((uart_data_buffer + 8) >> 8) & 0xff
   \   000088   12....       LCALL   ??Set_Zgb_param?relay
    269          				break;
   \   00008B   8003         SJMP    ??SerialApp_CallBack_0
    270          			case WRT_ZGB_GET_INFO_CMD:
    271          				Get_Zgb_param();
   \                     ??SerialApp_CallBack_3:
   \   00008D                ; Setup parameters for call to function Get_Zgb_param
   \   00008D   12....       LCALL   ??Get_Zgb_param?relay
    272          				break;
    273          			default:
    274          				break;
    275          		}
    276          	}
    277             }
    278          
    279          }
   \                     ??SerialApp_CallBack_0:
   \   000090   7F04         MOV     R7,#0x4
   \   000092   02....       LJMP    ?BANKED_LEAVE_XDATA
    280          

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    281          int pack_msg_ack_param(Msg_WRT_Zg_Set_Get_info *mzwt, char *pout)
   \                     pack_msg_ack_param:
    282          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 8
   \   000005   74F8         MOV     A,#-0x8
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EC           MOV     A,R4
   \   00000B   FE           MOV     R6,A
   \   00000C   ED           MOV     A,R5
   \   00000D   FF           MOV     R7,A
    283          	char *pt;
    284              pt = pout;
    285          	Zg_Header_Struct hd;
    286          	
    287          	hd.head = 0x7e7e;
   \   00000E   85..82       MOV     DPL,?XSP + 0
   \   000011   85..83       MOV     DPH,?XSP + 1
   \   000014   747E         MOV     A,#0x7e
   \   000016   F0           MOVX    @DPTR,A
   \   000017   A3           INC     DPTR
   \   000018   F0           MOVX    @DPTR,A
    288          	hd.msg_serial_num = globa_run_num++;
   \   000019   90....       MOV     DPTR,#globa_run_num
   \   00001C   E0           MOVX    A,@DPTR
   \   00001D   C0E0         PUSH    A
   \   00001F   7402         MOV     A,#0x2
   \   000021   12....       LCALL   ?XSTACK_DISP0_8
   \   000024   D0E0         POP     A
   \   000026   F0           MOVX    @DPTR,A
   \   000027   90....       MOV     DPTR,#globa_run_num
   \   00002A   E0           MOVX    A,@DPTR
   \   00002B   04           INC     A
   \   00002C   F0           MOVX    @DPTR,A
    289          	hd.msg_cmd = ZGB_WRT_ACK_INFO_CMD;
   \   00002D   7403         MOV     A,#0x3
   \   00002F   12....       LCALL   ?XSTACK_DISP0_8
   \   000032   7403         MOV     A,#0x3
   \   000034   F0           MOVX    @DPTR,A
   \   000035   A3           INC     DPTR
   \   000036   E4           CLR     A
   \   000037   F0           MOVX    @DPTR,A
    290          	hd.msg_len = sizeof(Msg_WRT_Zg_Set_Get_info) ;
   \   000038   7405         MOV     A,#0x5
   \   00003A   12....       LCALL   ?XSTACK_DISP0_8
   \   00003D   740B         MOV     A,#0xb
   \   00003F   F0           MOVX    @DPTR,A
   \   000040   A3           INC     DPTR
   \   000041   E4           CLR     A
   \   000042   F0           MOVX    @DPTR,A
    291          	pt += sizeof(Zg_Header_Struct);
    292          	
    293          	osal_memcpy(pt, (char *)mzwt, sizeof(Msg_WRT_Zg_Set_Get_info));
   \   000043                ; Setup parameters for call to function osal_memcpy
   \   000043   8A..         MOV     ?V0 + 0,R2
   \   000045   8B..         MOV     ?V0 + 1,R3
   \   000047   F5..         MOV     ?V0 + 2,A
   \   000049   78..         MOV     R0,#?V0 + 0
   \   00004B   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   00004E   7C0B         MOV     R4,#0xb
   \   000050   7D00         MOV     R5,#0x0
   \   000052   EE           MOV     A,R6
   \   000053   2408         ADD     A,#0x8
   \   000055   FA           MOV     R2,A
   \   000056   EF           MOV     A,R7
   \   000057   3400         ADDC    A,#0x0
   \   000059   FB           MOV     R3,A
   \   00005A   12....       LCALL   ??osal_memcpy?relay
   \   00005D   7403         MOV     A,#0x3
   \   00005F   12....       LCALL   ?DEALLOC_XSTACK8
    294          	pt += sizeof(Msg_WRT_Zg_Set_Get_info);
    295          
    296          	hd.crc8 = Calc_CRC8((uint8 *)pout+sizeof(hd), hd.msg_len);
   \   000062                ; Setup parameters for call to function Calc_CRC8
   \   000062   7405         MOV     A,#0x5
   \   000064   12....       LCALL   ?XSTACK_DISP0_8
   \   000067   E0           MOVX    A,@DPTR
   \   000068   F5..         MOV     ?V0 + 0,A
   \   00006A   A3           INC     DPTR
   \   00006B   E0           MOVX    A,@DPTR
   \   00006C   F5..         MOV     ?V0 + 1,A
   \   00006E   E4           CLR     A
   \   00006F   F5..         MOV     ?V0 + 3,A
   \   000071   78..         MOV     R0,#?V0 + 0
   \   000073   12....       LCALL   ?PUSH_XSTACK_I_FOUR
   \   000076   EE           MOV     A,R6
   \   000077   2408         ADD     A,#0x8
   \   000079   FA           MOV     R2,A
   \   00007A   EF           MOV     A,R7
   \   00007B   3400         ADDC    A,#0x0
   \   00007D   FB           MOV     R3,A
   \   00007E   12....       LCALL   ??Calc_CRC8?relay
   \   000081   7404         MOV     A,#0x4
   \   000083   12....       LCALL   ?DEALLOC_XSTACK8
   \   000086   E9           MOV     A,R1
   \   000087   C0E0         PUSH    A
   \   000089   7407         MOV     A,#0x7
   \   00008B   12....       LCALL   ?XSTACK_DISP0_8
   \   00008E   D0E0         POP     A
   \   000090   F0           MOVX    @DPTR,A
    297          	osal_memcpy(pout,(char *)&hd, sizeof(Zg_Header_Struct));
   \   000091                ; Setup parameters for call to function osal_memcpy
   \   000091   85..82       MOV     DPL,?XSP + 0
   \   000094   85..83       MOV     DPH,?XSP + 1
   \   000097   A982         MOV     R1,DPL
   \   000099   AA83         MOV     R2,DPH
   \   00009B   89..         MOV     ?V0 + 0,R1
   \   00009D   8A..         MOV     ?V0 + 1,R2
   \   00009F   78..         MOV     R0,#?V0 + 0
   \   0000A1   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   0000A4   7C08         MOV     R4,#0x8
   \   0000A6   7D00         MOV     R5,#0x0
   \   0000A8   EE           MOV     A,R6
   \   0000A9   FA           MOV     R2,A
   \   0000AA   EF           MOV     A,R7
   \   0000AB   FB           MOV     R3,A
   \   0000AC   12....       LCALL   ??osal_memcpy?relay
   \   0000AF   7403         MOV     A,#0x3
   \   0000B1   12....       LCALL   ?DEALLOC_XSTACK8
    298          
    299          	return hd.msg_len + sizeof(Zg_Header_Struct);       	
   \   0000B4   7405         MOV     A,#0x5
   \   0000B6   12....       LCALL   ?XSTACK_DISP0_8
   \   0000B9   E0           MOVX    A,@DPTR
   \   0000BA   2408         ADD     A,#0x8
   \   0000BC   FA           MOV     R2,A
   \   0000BD   A3           INC     DPTR
   \   0000BE   E0           MOVX    A,@DPTR
   \   0000BF   3400         ADDC    A,#0x0
   \   0000C1   FB           MOV     R3,A
   \   0000C2   7408         MOV     A,#0x8
   \   0000C4   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000C7   7F04         MOV     R7,#0x4
   \   0000C9   02....       LJMP    ?BANKED_LEAVE_XDATA
    300          }
    301          

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    302          int  pack_msg_transfer(Msg_Zg_WRT_transfer *mzwt,uint8 *pdata,uint16 dataLen, char *pout)
   \                     pack_msg_transfer:
    303          {
   \   000000   74ED         MOV     A,#-0x13
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 19
   \   000005                ; Auto size: 8
   \   000005   74F8         MOV     A,#-0x8
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   8C..         MOV     ?V0 + 8,R4
   \   00000C   8D..         MOV     ?V0 + 9,R5
   \   00000E   741B         MOV     A,#0x1b
   \   000010   12....       LCALL   ?XSTACK_DISP0_8
   \   000013   E0           MOVX    A,@DPTR
   \   000014   F5..         MOV     ?V0 + 0,A
   \   000016   A3           INC     DPTR
   \   000017   E0           MOVX    A,@DPTR
   \   000018   F5..         MOV     ?V0 + 1,A
   \   00001A   741D         MOV     A,#0x1d
   \   00001C   12....       LCALL   ?XSTACK_DISP0_8
   \   00001F   E0           MOVX    A,@DPTR
   \   000020   FE           MOV     R6,A
   \   000021   A3           INC     DPTR
   \   000022   E0           MOVX    A,@DPTR
   \   000023   FF           MOV     R7,A
    304              char *pt;
    305              pt = pout;
    306          	Zg_Header_Struct hd;
    307          	
    308          	hd.head = 0x7e7e;
   \   000024   85..82       MOV     DPL,?XSP + 0
   \   000027   85..83       MOV     DPH,?XSP + 1
   \   00002A   747E         MOV     A,#0x7e
   \   00002C   F0           MOVX    @DPTR,A
   \   00002D   A3           INC     DPTR
   \   00002E   F0           MOVX    @DPTR,A
    309          	hd.msg_serial_num = globa_run_num++;
   \   00002F   90....       MOV     DPTR,#globa_run_num
   \   000032   E0           MOVX    A,@DPTR
   \   000033   C0E0         PUSH    A
   \   000035   7402         MOV     A,#0x2
   \   000037   12....       LCALL   ?XSTACK_DISP0_8
   \   00003A   D0E0         POP     A
   \   00003C   F0           MOVX    @DPTR,A
   \   00003D   90....       MOV     DPTR,#globa_run_num
   \   000040   E0           MOVX    A,@DPTR
   \   000041   04           INC     A
   \   000042   F0           MOVX    @DPTR,A
    310          	hd.msg_cmd = ZGB_WRT_DATA_CMD;
   \   000043   7403         MOV     A,#0x3
   \   000045   12....       LCALL   ?XSTACK_DISP0_8
   \   000048   7402         MOV     A,#0x2
   \   00004A   F0           MOVX    @DPTR,A
   \   00004B   A3           INC     DPTR
   \   00004C   E4           CLR     A
   \   00004D   F0           MOVX    @DPTR,A
    311          	hd.msg_len = sizeof(Msg_Zg_WRT_transfer) + dataLen;// point size is 2 byte
   \   00004E   E5..         MOV     A,?V0 + 0
   \   000050   240F         ADD     A,#0xf
   \   000052   F8           MOV     R0,A
   \   000053   E5..         MOV     A,?V0 + 1
   \   000055   3400         ADDC    A,#0x0
   \   000057   F9           MOV     R1,A
   \   000058   7405         MOV     A,#0x5
   \   00005A   12....       LCALL   ?XSTACK_DISP0_8
   \   00005D   E8           MOV     A,R0
   \   00005E   F0           MOVX    @DPTR,A
   \   00005F   A3           INC     DPTR
   \   000060   E9           MOV     A,R1
   \   000061   F0           MOVX    @DPTR,A
    312          	pt += sizeof(Zg_Header_Struct);
   \   000062   EE           MOV     A,R6
   \   000063   2408         ADD     A,#0x8
   \   000065   F5..         MOV     ?V0 + 2,A
   \   000067   EF           MOV     A,R7
   \   000068   3400         ADDC    A,#0x0
   \   00006A   F5..         MOV     ?V0 + 3,A
    313          	
    314          	osal_memcpy(pt,(char *)mzwt, sizeof(Msg_Zg_WRT_transfer));
   \   00006C                ; Setup parameters for call to function osal_memcpy
   \   00006C   8A..         MOV     ?V0 + 4,R2
   \   00006E   8B..         MOV     ?V0 + 5,R3
   \   000070   75..00       MOV     ?V0 + 6,#0x0
   \   000073   78..         MOV     R0,#?V0 + 4
   \   000075   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   000078   7C0F         MOV     R4,#0xf
   \   00007A   7D00         MOV     R5,#0x0
   \   00007C   AA..         MOV     R2,?V0 + 2
   \   00007E   AB..         MOV     R3,?V0 + 3
   \   000080   12....       LCALL   ??osal_memcpy?relay
   \   000083   7403         MOV     A,#0x3
   \   000085   12....       LCALL   ?DEALLOC_XSTACK8
    315          	pt += sizeof(Msg_Zg_WRT_transfer);
    316          	osal_memcpy(pt,pdata, dataLen);	
   \   000088                ; Setup parameters for call to function osal_memcpy
   \   000088   75..00       MOV     ?V0 + 10,#0x0
   \   00008B   78..         MOV     R0,#?V0 + 8
   \   00008D   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   000090   AC..         MOV     R4,?V0 + 0
   \   000092   AD..         MOV     R5,?V0 + 1
   \   000094   E5..         MOV     A,?V0 + 2
   \   000096   240F         ADD     A,#0xf
   \   000098   FA           MOV     R2,A
   \   000099   E5..         MOV     A,?V0 + 3
   \   00009B   3400         ADDC    A,#0x0
   \   00009D   FB           MOV     R3,A
   \   00009E   12....       LCALL   ??osal_memcpy?relay
   \   0000A1   7403         MOV     A,#0x3
   \   0000A3   12....       LCALL   ?DEALLOC_XSTACK8
    317          	pt += dataLen;
    318          
    319          	hd.crc8 = Calc_CRC8((uint8 *)pout+sizeof(hd), hd.msg_len);
   \   0000A6                ; Setup parameters for call to function Calc_CRC8
   \   0000A6   7405         MOV     A,#0x5
   \   0000A8   12....       LCALL   ?XSTACK_DISP0_8
   \   0000AB   E0           MOVX    A,@DPTR
   \   0000AC   F5..         MOV     ?V0 + 0,A
   \   0000AE   A3           INC     DPTR
   \   0000AF   E0           MOVX    A,@DPTR
   \   0000B0   F5..         MOV     ?V0 + 1,A
   \   0000B2   E4           CLR     A
   \   0000B3   F5..         MOV     ?V0 + 2,A
   \   0000B5   F5..         MOV     ?V0 + 3,A
   \   0000B7   78..         MOV     R0,#?V0 + 0
   \   0000B9   12....       LCALL   ?PUSH_XSTACK_I_FOUR
   \   0000BC   EE           MOV     A,R6
   \   0000BD   2408         ADD     A,#0x8
   \   0000BF   FA           MOV     R2,A
   \   0000C0   EF           MOV     A,R7
   \   0000C1   3400         ADDC    A,#0x0
   \   0000C3   FB           MOV     R3,A
   \   0000C4   12....       LCALL   ??Calc_CRC8?relay
   \   0000C7   7404         MOV     A,#0x4
   \   0000C9   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000CC   E9           MOV     A,R1
   \   0000CD   C0E0         PUSH    A
   \   0000CF   7407         MOV     A,#0x7
   \   0000D1   12....       LCALL   ?XSTACK_DISP0_8
   \   0000D4   D0E0         POP     A
   \   0000D6   F0           MOVX    @DPTR,A
    320          	osal_memcpy(pout,(char *)&hd, sizeof(Zg_Header_Struct));
   \   0000D7                ; Setup parameters for call to function osal_memcpy
   \   0000D7   85..82       MOV     DPL,?XSP + 0
   \   0000DA   85..83       MOV     DPH,?XSP + 1
   \   0000DD   A982         MOV     R1,DPL
   \   0000DF   AA83         MOV     R2,DPH
   \   0000E1   89..         MOV     ?V0 + 0,R1
   \   0000E3   8A..         MOV     ?V0 + 1,R2
   \   0000E5   78..         MOV     R0,#?V0 + 0
   \   0000E7   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   0000EA   7C08         MOV     R4,#0x8
   \   0000EC   7D00         MOV     R5,#0x0
   \   0000EE   EE           MOV     A,R6
   \   0000EF   FA           MOV     R2,A
   \   0000F0   EF           MOV     A,R7
   \   0000F1   FB           MOV     R3,A
   \   0000F2   12....       LCALL   ??osal_memcpy?relay
   \   0000F5   7403         MOV     A,#0x3
   \   0000F7   12....       LCALL   ?DEALLOC_XSTACK8
    321          
    322          	return hd.msg_len + sizeof(Zg_Header_Struct);                       
   \   0000FA   7405         MOV     A,#0x5
   \   0000FC   12....       LCALL   ?XSTACK_DISP0_8
   \   0000FF   E0           MOVX    A,@DPTR
   \   000100   2408         ADD     A,#0x8
   \   000102   FA           MOV     R2,A
   \   000103   A3           INC     DPTR
   \   000104   E0           MOVX    A,@DPTR
   \   000105   3400         ADDC    A,#0x0
   \   000107   FB           MOV     R3,A
   \   000108   7408         MOV     A,#0x8
   \   00010A   12....       LCALL   ?DEALLOC_XSTACK8
   \   00010D   7F0B         MOV     R7,#0xb
   \   00010F   02....       LJMP    ?BANKED_LEAVE_XDATA
    323          }
    324          
    325          /*
    326          init from flash
    327          */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    328          int  init_from_flash(void)
   \                     init_from_flash:
    329          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 6
   \   000005   74FA         MOV     A,#-0x6
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
    330          
    331          	uint8   tempbuf[6];
    332              osal_memset(tempbuf,0,6);
   \   00000A                ; Setup parameters for call to function osal_memset
   \   00000A   7C06         MOV     R4,#0x6
   \   00000C   7D00         MOV     R5,#0x0
   \   00000E   7900         MOV     R1,#0x0
   \   000010   85..82       MOV     DPL,?XSP + 0
   \   000013   85..83       MOV     DPH,?XSP + 1
   \   000016   AA82         MOV     R2,DPL
   \   000018   AB83         MOV     R3,DPH
   \   00001A   12....       LCALL   ??osal_memset?relay
    333          	 
    334          	if(osal_nv_read(PANID_PROFILE_ENDPOINT_ADDR,0, 2, &tempbuf) == ZSUCCESS)
   \   00001D                ; Setup parameters for call to function osal_nv_read
   \   00001D   85..82       MOV     DPL,?XSP + 0
   \   000020   85..83       MOV     DPH,?XSP + 1
   \   000023   8582..       MOV     ?V0 + 0,DPL
   \   000026   8583..       MOV     ?V0 + 1,DPH
   \   000029   78..         MOV     R0,#?V0 + 0
   \   00002B   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00002E   75..02       MOV     ?V0 + 0,#0x2
   \   000031   75..00       MOV     ?V0 + 1,#0x0
   \   000034   78..         MOV     R0,#?V0 + 0
   \   000036   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000039   7C00         MOV     R4,#0x0
   \   00003B   7D00         MOV     R5,#0x0
   \   00003D   7A02         MOV     R2,#0x2
   \   00003F   7B02         MOV     R3,#0x2
   \   000041   12....       LCALL   ??osal_nv_read?relay
   \   000044   7404         MOV     A,#0x4
   \   000046   12....       LCALL   ?DEALLOC_XSTACK8
   \   000049   E9           MOV     A,R1
   \   00004A   7026         JNZ     ??init_from_flash_0
    335          	{
    336          //		user_panid = tempbuf[0] + (tempbuf[1] << 8);
    337          
    338          		SampleApp_SimpleDesc.AppProfId = tempbuf[2] + (tempbuf[3] << 8);
   \   00004C   7402         MOV     A,#0x2
   \   00004E   12....       LCALL   ?XSTACK_DISP0_8
   \   000051   E0           MOVX    A,@DPTR
   \   000052   FA           MOV     R2,A
   \   000053   7403         MOV     A,#0x3
   \   000055   12....       LCALL   ?XSTACK_DISP0_8
   \   000058   E0           MOVX    A,@DPTR
   \   000059   F9           MOV     R1,A
   \   00005A   EA           MOV     A,R2
   \   00005B   90....       MOV     DPTR,#SampleApp_SimpleDesc + 1
   \   00005E   F0           MOVX    @DPTR,A
   \   00005F   A3           INC     DPTR
   \   000060   E9           MOV     A,R1
   \   000061   F0           MOVX    @DPTR,A
    339          
    340          		SampleApp_epDesc.endPoint=tempbuf[4];
   \   000062   7404         MOV     A,#0x4
   \   000064   12....       LCALL   ?XSTACK_DISP0_8
   \   000067   E0           MOVX    A,@DPTR
   \   000068   90....       MOV     DPTR,#SampleApp_epDesc
   \   00006B   F0           MOVX    @DPTR,A
    341            	        return 0;
   \   00006C   7A00         MOV     R2,#0x0
   \   00006E   7B00         MOV     R3,#0x0
   \   000070   8004         SJMP    ??init_from_flash_1
    342          	}
    343                  return -1;
   \                     ??init_from_flash_0:
   \   000072   7AFF         MOV     R2,#-0x1
   \   000074   7BFF         MOV     R3,#-0x1
   \                     ??init_from_flash_1:
   \   000076   7406         MOV     A,#0x6
   \   000078   12....       LCALL   ?DEALLOC_XSTACK8
   \   00007B   7F02         MOV     R7,#0x2
   \   00007D   02....       LJMP    ?BANKED_LEAVE_XDATA
    344          }
    345          /*********************************************************************
    346           * @fn      SampleApp_Init
    347           *
    348           * @brief   Initialization function for the Generic App Task.
    349           *          This is called during initialization and should contain
    350           *          any application specific initialization (ie. hardware
    351           *          initialization/setup, table initialization, power up
    352           *          notificaiton ... ).
    353           *
    354           * @param   task_id - the ID assigned by OSAL.  This ID should be
    355           *                    used to send messages and set timers.
    356           *
    357           * @return  none
    358           */
    359          

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    360          void SampleApp_Init( uint8 task_id )
   \                     SampleApp_Init:
    361          { 
   \   000000   74F5         MOV     A,#-0xb
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 11
   \   000005                ; Auto size: 35
   \   000005   74DD         MOV     A,#-0x23
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   E9           MOV     A,R1
    362            SampleApp_TaskID = task_id;
   \   00000B   90....       MOV     DPTR,#SampleApp_TaskID
   \   00000E   F0           MOVX    @DPTR,A
    363            SampleApp_NwkState = DEV_INIT;
   \   00000F   90....       MOV     DPTR,#SampleApp_NwkState
   \   000012   7401         MOV     A,#0x1
   \   000014   F0           MOVX    @DPTR,A
    364          //  SampleApp_TransID = 0;
    365            
    366            //------------------------配置串口---------------------------------
    367            //MT_UartInit();                    //串口初始化
    368            //MT_UartRegisterTaskID(task_id);   //注册串口任务
    369             //HalUARTWrite(0,"UartInit OK\n", sizeof("UartInit OK\n"));//串口发送
    370            //-----------------------------------------------------------------
    371              
    372            
    373            halUARTCfg_t uartConfig ;
    374            uartConfig.configured           = TRUE;              // 2x30 don't care - see uart driver.
   \   000015   7406         MOV     A,#0x6
   \   000017   12....       LCALL   ?XSTACK_DISP0_8
   \   00001A   7401         MOV     A,#0x1
   \   00001C   F0           MOVX    @DPTR,A
    375            uartConfig.baudRate             = HAL_UART_BR_115200;
   \   00001D   7407         MOV     A,#0x7
   \   00001F   12....       LCALL   ?XSTACK_DISP0_8
   \   000022   7404         MOV     A,#0x4
   \   000024   F0           MOVX    @DPTR,A
    376            uartConfig.flowControl          = TRUE;
   \   000025   7408         MOV     A,#0x8
   \   000027   12....       LCALL   ?XSTACK_DISP0_8
   \   00002A   7401         MOV     A,#0x1
   \   00002C   F0           MOVX    @DPTR,A
    377            uartConfig.flowControlThreshold = 64; // 2x30 don't care - see uart driver.
   \   00002D   7409         MOV     A,#0x9
   \   00002F   12....       LCALL   ?XSTACK_DISP0_8
   \   000032   7440         MOV     A,#0x40
   \   000034   F0           MOVX    @DPTR,A
   \   000035   A3           INC     DPTR
   \   000036   E4           CLR     A
   \   000037   F0           MOVX    @DPTR,A
    378            uartConfig.rx.maxBufSize        = 128;  // 2x30 don't care - see uart driver.
   \   000038   7410         MOV     A,#0x10
   \   00003A   12....       LCALL   ?XSTACK_DISP0_8
   \   00003D   7480         MOV     A,#-0x80
   \   00003F   F0           MOVX    @DPTR,A
   \   000040   A3           INC     DPTR
   \   000041   E4           CLR     A
   \   000042   F0           MOVX    @DPTR,A
    379            uartConfig.tx.maxBufSize        = 128;  // 2x30 don't care - see uart driver.
   \   000043   7418         MOV     A,#0x18
   \   000045   12....       LCALL   ?XSTACK_DISP0_8
   \   000048   7480         MOV     A,#-0x80
   \   00004A   F0           MOVX    @DPTR,A
   \   00004B   A3           INC     DPTR
   \   00004C   E4           CLR     A
   \   00004D   F0           MOVX    @DPTR,A
    380            uartConfig.idleTimeout          = 6;   // 2x30 don't care - see uart driver.
   \   00004E   740B         MOV     A,#0xb
   \   000050   12....       LCALL   ?XSTACK_DISP0_8
   \   000053   7406         MOV     A,#0x6
   \   000055   F0           MOVX    @DPTR,A
    381            uartConfig.intEnable            = TRUE;              // 2x30 don't care - see uart driver.
   \   000056   741C         MOV     A,#0x1c
   \   000058   12....       LCALL   ?XSTACK_DISP0_8
   \   00005B   7401         MOV     A,#0x1
   \   00005D   F0           MOVX    @DPTR,A
    382            uartConfig.callBackFunc         = SerialApp_CallBack;
   \   00005E   7421         MOV     A,#0x21
   \   000060   12....       LCALL   ?XSTACK_DISP0_8
   \   000063   74..         MOV     A,#??SerialApp_CallBack?relay & 0xff
   \   000065   F0           MOVX    @DPTR,A
   \   000066   A3           INC     DPTR
   \   000067   74..         MOV     A,#(??SerialApp_CallBack?relay >> 8) & 0xff
   \   000069   F0           MOVX    @DPTR,A
    383            HalUARTOpen (0, &uartConfig);
   \   00006A                ; Setup parameters for call to function HalUARTOpen
   \   00006A   7406         MOV     A,#0x6
   \   00006C   12....       LCALL   ?XSTACK_DISP0_8
   \   00006F   AA82         MOV     R2,DPL
   \   000071   AB83         MOV     R3,DPH
   \   000073   7900         MOV     R1,#0x0
   \   000075   12....       LCALL   ??HalUARTOpen?relay
    384            
    385            // Device hardware initialization can be added here or in main() (Zmain.c).
    386            // If the hardware is application specific - add it here.
    387            // If the hardware is other parts of the device add it in main().
    388          
    389           #if defined ( BUILD_ALL_DEVICES )
    390            // The "Demo" target is setup to have BUILD_ALL_DEVICES and HOLD_AUTO_START
    391            // We are looking at a jumper (defined in SampleAppHw.c) to be jumpered
    392            // together - if they are - we will start up a coordinator. Otherwise,
    393            // the device will start as a router.
    394            if ( readCoordinatorJumper() )
    395              zgDeviceLogicalType = ZG_DEVICETYPE_COORDINATOR;
    396            else
    397              zgDeviceLogicalType = ZG_DEVICETYPE_ROUTER;
    398          #endif // BUILD_ALL_DEVICES
    399          
    400          #if defined ( HOLD_AUTO_START )
    401            // HOLD_AUTO_START is a compile option that will surpress ZDApp
    402            //  from starting the device and wait for the application to
    403            //  start the device.
    404            ZDOInitDevice(0);
    405          #endif
    406          
    407            // Setup for the periodic message's destination address
    408            // Broadcast to everyone
    409          //  SampleApp_Periodic_DstAddr.addrMode = (afAddrMode_t)AddrBroadcast;
    410          //  SampleApp_Periodic_DstAddr.endPoint = SAMPLEAPP_ENDPOINT;
    411          //  SampleApp_Periodic_DstAddr.addr.shortAddr = 0xFFFF;
    412          
    413            // Setup for the flash command's destination address - Group 1
    414          //  SampleApp_Flash_DstAddr.addrMode = (afAddrMode_t)afAddrGroup;
    415          //  SampleApp_Flash_DstAddr.endPoint = SAMPLEAPP_ENDPOINT;
    416          //  SampleApp_Flash_DstAddr.addr.shortAddr = SAMPLEAPP_FLASH_GROUP;
    417          
    418            //P2P initialize
    419          //  SampleApp_P2P_DstAddr.addrMode = (afAddrMode_t)Addr16Bit;
    420          //  SampleApp_P2P_DstAddr.endPoint = SAMPLEAPP_ENDPOINT;  
    421          //  SampleApp_P2P_DstAddr.addr.shortAddr = 0x0000;//发给协调器
    422          
    423          
    424          
    425            // Fill out the endpoint description.
    426            uint8   tempbuf[6];
    427            osal_memset(tempbuf,0,6);
   \   000078                ; Setup parameters for call to function osal_memset
   \   000078   7C06         MOV     R4,#0x6
   \   00007A   7D00         MOV     R5,#0x0
   \   00007C   7900         MOV     R1,#0x0
   \   00007E   85..82       MOV     DPL,?XSP + 0
   \   000081   85..83       MOV     DPH,?XSP + 1
   \   000084   AA82         MOV     R2,DPL
   \   000086   AB83         MOV     R3,DPH
   \   000088   12....       LCALL   ??osal_memset?relay
    428             
    429            if(osal_nv_read(PANID_PROFILE_ENDPOINT_ADDR,0, 6, &tempbuf) == ZSUCCESS)
   \   00008B                ; Setup parameters for call to function osal_nv_read
   \   00008B   85..82       MOV     DPL,?XSP + 0
   \   00008E   85..83       MOV     DPH,?XSP + 1
   \   000091   8582..       MOV     ?V0 + 0,DPL
   \   000094   8583..       MOV     ?V0 + 1,DPH
   \   000097   78..         MOV     R0,#?V0 + 0
   \   000099   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00009C   75..06       MOV     ?V0 + 0,#0x6
   \   00009F   75..00       MOV     ?V0 + 1,#0x0
   \   0000A2   78..         MOV     R0,#?V0 + 0
   \   0000A4   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000A7   7C00         MOV     R4,#0x0
   \   0000A9   7D00         MOV     R5,#0x0
   \   0000AB   7A02         MOV     R2,#0x2
   \   0000AD   7B02         MOV     R3,#0x2
   \   0000AF   12....       LCALL   ??osal_nv_read?relay
   \   0000B2   7404         MOV     A,#0x4
   \   0000B4   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000B7   E9           MOV     A,R1
   \   0000B8   7024         JNZ     ??SampleApp_Init_0
    430            {
    431          //	  user_panid = tempbuf[0] + (tempbuf[1] << 8);
    432          	  SampleApp_SimpleDesc.AppProfId = tempbuf[2] + (tempbuf[3] << 8);
   \   0000BA   7402         MOV     A,#0x2
   \   0000BC   12....       LCALL   ?XSTACK_DISP0_8
   \   0000BF   E0           MOVX    A,@DPTR
   \   0000C0   FA           MOV     R2,A
   \   0000C1   7403         MOV     A,#0x3
   \   0000C3   12....       LCALL   ?XSTACK_DISP0_8
   \   0000C6   E0           MOVX    A,@DPTR
   \   0000C7   F9           MOV     R1,A
   \   0000C8   EA           MOV     A,R2
   \   0000C9   90....       MOV     DPTR,#SampleApp_SimpleDesc + 1
   \   0000CC   F0           MOVX    @DPTR,A
   \   0000CD   A3           INC     DPTR
   \   0000CE   E9           MOV     A,R1
   \   0000CF   F0           MOVX    @DPTR,A
    433          	  SampleApp_SimpleDesc.EndPoint=tempbuf[4];
   \   0000D0   7404         MOV     A,#0x4
   \   0000D2   12....       LCALL   ?XSTACK_DISP0_8
   \   0000D5   E0           MOVX    A,@DPTR
   \   0000D6   90....       MOV     DPTR,#SampleApp_SimpleDesc
   \   0000D9   F0           MOVX    @DPTR,A
    434          	  SampleApp_epDesc.endPoint=tempbuf[4];
   \   0000DA   90....       MOV     DPTR,#SampleApp_epDesc
   \   0000DD   F0           MOVX    @DPTR,A
    435            }
    436          
    437            
    438          //  SampleApp_epDesc.endPoint = SAMPLEAPP_ENDPOINT;
    439            SampleApp_epDesc.task_id = &SampleApp_TaskID;
   \                     ??SampleApp_Init_0:
   \   0000DE   90....       MOV     DPTR,#SampleApp_epDesc + 1
   \   0000E1   74..         MOV     A,#SampleApp_TaskID & 0xff
   \   0000E3   F0           MOVX    @DPTR,A
   \   0000E4   A3           INC     DPTR
   \   0000E5   74..         MOV     A,#(SampleApp_TaskID >> 8) & 0xff
   \   0000E7   F0           MOVX    @DPTR,A
    440            SampleApp_epDesc.simpleDesc = (SimpleDescriptionFormat_t *)&SampleApp_SimpleDesc;
   \   0000E8   A3           INC     DPTR
   \   0000E9   74..         MOV     A,#SampleApp_SimpleDesc & 0xff
   \   0000EB   F0           MOVX    @DPTR,A
   \   0000EC   A3           INC     DPTR
   \   0000ED   74..         MOV     A,#(SampleApp_SimpleDesc >> 8) & 0xff
   \   0000EF   F0           MOVX    @DPTR,A
    441            SampleApp_epDesc.latencyReq = noLatencyReqs;
   \   0000F0   A3           INC     DPTR
   \   0000F1   E4           CLR     A
   \   0000F2   F0           MOVX    @DPTR,A
    442          
    443            // Register the endpoint description with the AF
    444            afRegister( &SampleApp_epDesc );
   \   0000F3                ; Setup parameters for call to function afRegister
   \   0000F3   7A..         MOV     R2,#SampleApp_epDesc & 0xff
   \   0000F5   7B..         MOV     R3,#(SampleApp_epDesc >> 8) & 0xff
   \   0000F7   12....       LCALL   ??afRegister?relay
    445          
    446            // Register for all key events - This app will handle all key events
    447          //  RegisterForKeys( SampleApp_TaskID );
    448          
    449            // By default, all devices start out in Group 1
    450            SampleApp_Group.ID = 0x0001;
   \   0000FA   90....       MOV     DPTR,#SampleApp_Group
   \   0000FD   7401         MOV     A,#0x1
   \   0000FF   F0           MOVX    @DPTR,A
   \   000100   A3           INC     DPTR
   \   000101   E4           CLR     A
   \   000102   F0           MOVX    @DPTR,A
    451            osal_memcpy( SampleApp_Group.name, "Group 1", 7  );
   \   000103                ; Setup parameters for call to function osal_memcpy
   \   000103   75....       MOV     ?V0 + 0,#`?<Constant "Group 1">` & 0xff
   \   000106   75....       MOV     ?V0 + 1,#(`?<Constant "Group 1">` >> 8) & 0xff
   \   000109   F5..         MOV     ?V0 + 2,A
   \   00010B   78..         MOV     R0,#?V0 + 0
   \   00010D   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   000110   7C07         MOV     R4,#0x7
   \   000112   7D00         MOV     R5,#0x0
   \   000114   7A..         MOV     R2,#(SampleApp_Group + 2) & 0xff
   \   000116   7B..         MOV     R3,#((SampleApp_Group + 2) >> 8) & 0xff
   \   000118   12....       LCALL   ??osal_memcpy?relay
   \   00011B   7403         MOV     A,#0x3
   \   00011D   12....       LCALL   ?DEALLOC_XSTACK8
    452            aps_AddGroup( SAMPLEAPP_ENDPOINT, &SampleApp_Group);
   \   000120                ; Setup parameters for call to function aps_AddGroup
   \   000120   7A..         MOV     R2,#SampleApp_Group & 0xff
   \   000122   7B..         MOV     R3,#(SampleApp_Group >> 8) & 0xff
   \   000124   7914         MOV     R1,#0x14
   \   000126   12....       LCALL   ??aps_AddGroup?relay
    453          
    454          #if defined ( LCD_SUPPORTED )
    455            HalLcdWriteString( "SampleApp", HAL_LCD_LINE_1 );
   \   000129                ; Setup parameters for call to function HalLcdWriteString
   \   000129   7901         MOV     R1,#0x1
   \   00012B   7A..         MOV     R2,#`?<Constant "SampleApp">` & 0xff
   \   00012D   7B..         MOV     R3,#(`?<Constant "SampleApp">` >> 8) & 0xff
   \   00012F   12....       LCALL   ??HalLcdWriteString?relay
    456          #endif
    457            
    458          //  osal_start_timerEx( SampleApp_TaskID, SYS_EVENT_MSG_USER_TM,5000);
    459          
    460             /*
    461            	flash block
    462            	short int value_read = 0; 
    463          	char str_read[8] ;
    464          	short int value = 0x0304;
    465          	char *str = "abcdefg";
    466          	int temp = strlen(str);
    467          	osal_nv_item_init(TEST_NV,7,NULL);//NULL表示初始化的时候，item数据部分为空
    468          	int len = osal_nv_item_len(TEST_NV);
    469          	osal_nv_write(TEST_NV,0,1,&value);
    470          	int len2 = osal_nv_item_len(TEST_NV);
    471          	osal_nv_read(TEST_NV,0,2,&value_read);
    472              */
    473          
    474          }
   \   000132   7423         MOV     A,#0x23
   \   000134   12....       LCALL   ?DEALLOC_XSTACK8
   \   000137   7F03         MOV     R7,#0x3
   \   000139   02....       LJMP    ?BANKED_LEAVE_XDATA
    475          
    476          
    477          
    478          /*********************************************************************
    479           * @fn      SampleApp_ProcessEvent
    480           *
    481           * @brief   Generic Application Task event processor.  This function
    482           *          is called to process all events for the task.  Events
    483           *          include timers, messages and any other user defined events.
    484           *
    485           * @param   task_id  - The OSAL assigned task ID.
    486           * @param   events - events to process.  This is a bit map and can
    487           *                   contain more than one event.
    488           *
    489           * @return  none
    490           */

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    491          char  buf[64];
   \                     buf:
   \   000000                DS 64
   \   000040                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    492          int   buflen;
   \                     buflen:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    493          uint16 SampleApp_ProcessEvent( uint8 task_id, uint16 events )
   \                     SampleApp_ProcessEvent:
    494          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
    495            afIncomingMSGPacket_t *MSGpkt;
    496            (void)task_id;  // Intentionally unreferenced parameter
    497          
    498            if ( events & SYS_EVENT_MSG )
   \   000009   5480         ANL     A,#0x80
   \   00000B   607E         JZ      ??SampleApp_ProcessEvent_0
    499            {
    500              MSGpkt = (afIncomingMSGPacket_t *)osal_msg_receive( SampleApp_TaskID );
   \   00000D                ; Setup parameters for call to function osal_msg_receive
   \   00000D   8013         SJMP    ??SampleApp_ProcessEvent_1
    501              while ( MSGpkt )
    502              {
    503                switch ( MSGpkt->hdr.event )
    504                {
    505                  // Received when a key is pressed
    506                  case KEY_CHANGE:
    507                    SampleApp_HandleKeys( ((keyChange_t *)MSGpkt)->state, ((keyChange_t *)MSGpkt)->keys );
    508                    break;
    509          
    510                  // Received when a messages is received (OTA) for this endpoint
    511                  case AF_INCOMING_MSG_CMD:
    512                    SampleApp_MessageMSGCB( MSGpkt );
    513                    break;
    514          
    515                  // Received whenever the device changes state in the network
    516                  case ZDO_STATE_CHANGE:
    517                    SampleApp_NwkState = (devStates_t)(MSGpkt->hdr.status);
    518                    if ( (SampleApp_NwkState == DEV_ZB_COORD)
    519                        //|| (SampleApp_NwkState == DEV_ROUTER)
    520                        //|| (SampleApp_NwkState == DEV_END_DEVICE) 
    521                        )
    522                    {
    523                      // Start sending the periodic message in a regular interval.
    524                      osal_start_timerEx( SampleApp_TaskID,
    525                                        SAMPLEAPP_SEND_PERIODIC_MSG_EVT,
    526                                        SAMPLEAPP_SEND_PERIODIC_MSG_TIMEOUT );
    527                    }
    528                    else
    529                    {
    530                      // Device is no longer in the network
    531                      osal_stop_timerEx(SampleApp_TaskID,SAMPLEAPP_SEND_PERIODIC_MSG_EVT);
   \                     ??SampleApp_ProcessEvent_2:
   \   00000F                ; Setup parameters for call to function osal_stop_timerEx
   \   00000F   7A01         MOV     R2,#0x1
   \   000011   7B00         MOV     R3,#0x0
   \   000013   90....       MOV     DPTR,#SampleApp_TaskID
   \   000016   E0           MOVX    A,@DPTR
   \   000017   F9           MOV     R1,A
   \   000018   12....       LCALL   ??osal_stop_timerEx?relay
    532                    }
    533                    break;
    534          
    535                  default:
    536                    break;
    537                }
    538          
    539                // Release the memory
    540                osal_msg_deallocate( (uint8 *)MSGpkt );
   \                     ??SampleApp_ProcessEvent_3:
   \   00001B                ; Setup parameters for call to function osal_msg_deallocate
   \   00001B   AA..         MOV     R2,?V0 + 0
   \   00001D   AB..         MOV     R3,?V0 + 1
   \   00001F   12....       LCALL   ??osal_msg_deallocate?relay
    541          
    542                // Next - if one is available
    543                MSGpkt = (afIncomingMSGPacket_t *)osal_msg_receive( SampleApp_TaskID );
   \   000022                ; Setup parameters for call to function osal_msg_receive
   \                     ??SampleApp_ProcessEvent_1:
   \   000022   90....       MOV     DPTR,#SampleApp_TaskID
   \   000025   E0           MOVX    A,@DPTR
   \   000026   F9           MOV     R1,A
   \   000027   12....       LCALL   ??osal_msg_receive?relay
   \   00002A   8A..         MOV     ?V0 + 0,R2
   \   00002C   8B..         MOV     ?V0 + 1,R3
   \   00002E   E5..         MOV     A,?V0 + 0
   \   000030   45..         ORL     A,?V0 + 1
   \   000032   604F         JZ      ??SampleApp_ProcessEvent_4
   \   000034   85..82       MOV     DPL,?V0 + 0
   \   000037   85..83       MOV     DPH,?V0 + 1
   \   00003A   E0           MOVX    A,@DPTR
   \   00003B   24E6         ADD     A,#-0x1a
   \   00003D   601E         JZ      ??SampleApp_ProcessEvent_5
   \   00003F   245A         ADD     A,#0x5a
   \   000041   6006         JZ      ??SampleApp_ProcessEvent_6
   \   000043   24EF         ADD     A,#-0x11
   \   000045   601F         JZ      ??SampleApp_ProcessEvent_7
   \   000047   80D2         SJMP    ??SampleApp_ProcessEvent_3
   \                     ??SampleApp_ProcessEvent_6:
   \   000049                ; Setup parameters for call to function SampleApp_HandleKeys
   \   000049   A3           INC     DPTR
   \   00004A   A3           INC     DPTR
   \   00004B   A3           INC     DPTR
   \   00004C   E0           MOVX    A,@DPTR
   \   00004D   FA           MOV     R2,A
   \   00004E   85..82       MOV     DPL,?V0 + 0
   \   000051   85..83       MOV     DPH,?V0 + 1
   \   000054   A3           INC     DPTR
   \   000055   A3           INC     DPTR
   \   000056   E0           MOVX    A,@DPTR
   \   000057   F9           MOV     R1,A
   \   000058   12....       LCALL   ??SampleApp_HandleKeys?relay
   \   00005B   80BE         SJMP    ??SampleApp_ProcessEvent_3
   \                     ??SampleApp_ProcessEvent_5:
   \   00005D                ; Setup parameters for call to function SampleApp_MessageMSGCB
   \   00005D   AA..         MOV     R2,?V0 + 0
   \   00005F   AB..         MOV     R3,?V0 + 1
   \   000061   12....       LCALL   ??SampleApp_MessageMSGCB?relay
   \   000064   80B5         SJMP    ??SampleApp_ProcessEvent_3
   \                     ??SampleApp_ProcessEvent_7:
   \   000066   A3           INC     DPTR
   \   000067   E0           MOVX    A,@DPTR
   \   000068   90....       MOV     DPTR,#SampleApp_NwkState
   \   00006B   F0           MOVX    @DPTR,A
   \   00006C   E0           MOVX    A,@DPTR
   \   00006D   6409         XRL     A,#0x9
   \   00006F   709E         JNZ     ??SampleApp_ProcessEvent_2
   \   000071                ; Setup parameters for call to function osal_start_timerEx
   \   000071   7CE8         MOV     R4,#-0x18
   \   000073   7D03         MOV     R5,#0x3
   \   000075   7A01         MOV     R2,#0x1
   \   000077   7B00         MOV     R3,#0x0
   \   000079   90....       MOV     DPTR,#SampleApp_TaskID
   \   00007C   E0           MOVX    A,@DPTR
   \   00007D   F9           MOV     R1,A
   \   00007E   12....       LCALL   ??osal_start_timerEx?relay
   \   000081   8098         SJMP    ??SampleApp_ProcessEvent_3
    544              }
    545          
    546              // return unprocessed events
    547              return (events ^ SYS_EVENT_MSG);
   \                     ??SampleApp_ProcessEvent_4:
   \   000083   EE           MOV     A,R6
   \   000084   FA           MOV     R2,A
   \   000085   EF           MOV     A,R7
   \   000086   6480         XRL     A,#0x80
   \                     ??SampleApp_ProcessEvent_8:
   \   000088   FB           MOV     R3,A
   \   000089   8031         SJMP    ??SampleApp_ProcessEvent_9
    548            }
    549          
    550            // Send a message out - This event is generated by a timer
    551            //  (setup in SampleApp_Init()).
    552            if ( events & SAMPLEAPP_SEND_PERIODIC_MSG_EVT )
   \                     ??SampleApp_ProcessEvent_0:
   \   00008B   EE           MOV     A,R6
   \   00008C   A2E0         MOV     C,0xE0 /* A   */.0
   \   00008E   501E         JNC     ??SampleApp_ProcessEvent_10
    553            {
    554              // Send the periodic message
    555              HalLedSet(HAL_LED_3,HAL_LED_MODE_TOGGLE);
   \   000090                ; Setup parameters for call to function HalLedSet
   \   000090   7A08         MOV     R2,#0x8
   \   000092   7904         MOV     R1,#0x4
   \   000094   12....       LCALL   ??HalLedSet?relay
    556             // SampleApp_SendPeriodicMessage();
    557          	  //增加点播的发送函数 
    558              // Setup to send message again in normal period (+ a little jitter)
    559          
    560          
    561              osal_start_timerEx( SampleApp_TaskID, SAMPLEAPP_SEND_PERIODIC_MSG_EVT,
    562                  (SAMPLEAPP_SEND_PERIODIC_MSG_TIMEOUT ) );
   \   000097                ; Setup parameters for call to function osal_start_timerEx
   \   000097   7CE8         MOV     R4,#-0x18
   \   000099   7D03         MOV     R5,#0x3
   \   00009B   7A01         MOV     R2,#0x1
   \   00009D   7B00         MOV     R3,#0x0
   \   00009F   90....       MOV     DPTR,#SampleApp_TaskID
   \   0000A2   E0           MOVX    A,@DPTR
   \   0000A3   F9           MOV     R1,A
   \   0000A4   12....       LCALL   ??osal_start_timerEx?relay
    563          
    564              // return unprocessed events
    565              return (events ^ SAMPLEAPP_SEND_PERIODIC_MSG_EVT);
   \   0000A7   EE           MOV     A,R6
   \   0000A8   6401         XRL     A,#0x1
   \   0000AA   FA           MOV     R2,A
   \   0000AB   EF           MOV     A,R7
   \   0000AC   80DA         SJMP    ??SampleApp_ProcessEvent_8
    566            }
    567            
    568            //user specific event
    569            if ( events & SYS_EVENT_MSG_USER_TM )
   \                     ??SampleApp_ProcessEvent_10:
   \   0000AE   5404         ANL     A,#0x4
   \   0000B0   6006         JZ      ??SampleApp_ProcessEvent_11
    570            {  
    571          
    572          	
    573          	  
    574          	  return (events ^ SYS_EVENT_MSG_USER_TM);
   \   0000B2   EE           MOV     A,R6
   \   0000B3   6404         XRL     A,#0x4
   \   0000B5   FA           MOV     R2,A
   \   0000B6   8004         SJMP    ??SampleApp_ProcessEvent_9
    575            }
    576           
    577            // Discard unknown events
    578            return 0;
   \                     ??SampleApp_ProcessEvent_11:
   \   0000B8   7A00         MOV     R2,#0x0
   \   0000BA   7B00         MOV     R3,#0x0
   \                     ??SampleApp_ProcessEvent_9:
   \   0000BC   7F04         MOV     R7,#0x4
   \   0000BE   02....       LJMP    ?BANKED_LEAVE_XDATA
    579          }
    580          
    581          /*********************************************************************
    582           * Event Generation Functions
    583           */
    584          /*********************************************************************
    585           * @fn      SampleApp_HandleKeys
    586           *
    587           * @brief   Handles all key events for this device.
    588           *
    589           * @param   shift - true if in shift/alt.
    590           * @param   keys - bit field for key events. Valid entries:
    591           *                 HAL_KEY_SW_2
    592           *                 HAL_KEY_SW_1
    593           *
    594           * @return  none
    595           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    596          void SampleApp_HandleKeys( uint8 shift, uint8 keys )
   \                     SampleApp_HandleKeys:
    597          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
    598            (void)shift;  // Intentionally unreferenced parameter
    599            
    600            if ( keys & HAL_KEY_SW_1 )
   \   000007   A2E0         MOV     C,0xE0 /* A   */.0
   \   000009   5007         JNC     ??SampleApp_HandleKeys_0
    601            {
    602              /* This key sends the Flash Command is sent to Group 1.
    603               * This device will not receive the Flash Command from this
    604               * device (even if it belongs to group 1).
    605               */
    606              SampleApp_SendFlashMessage( SAMPLEAPP_FLASH_DURATION );
   \   00000B                ; Setup parameters for call to function SampleApp_SendFlashMessage
   \   00000B   7AE8         MOV     R2,#-0x18
   \   00000D   7B03         MOV     R3,#0x3
   \   00000F   12....       LCALL   ??SampleApp_SendFlashMessage?relay
    607            }
    608          
    609            if ( keys & HAL_KEY_SW_2 )
   \                     ??SampleApp_HandleKeys_0:
   \   000012   EE           MOV     A,R6
   \   000013   A2E1         MOV     C,0xE0 /* A   */.1
   \   000015   5024         JNC     ??SampleApp_HandleKeys_1
    610            {
    611              /* The Flashr Command is sent to Group 1.
    612               * This key toggles this device in and out of group 1.
    613               * If this device doesn't belong to group 1, this application
    614               * will not receive the Flash command sent to group 1.
    615               */
    616              aps_Group_t *grp;
    617              grp = aps_FindGroup( SAMPLEAPP_ENDPOINT, SAMPLEAPP_FLASH_GROUP );
    618              if ( grp )
   \   000017                ; Setup parameters for call to function aps_FindGroup
   \   000017   7A01         MOV     R2,#0x1
   \   000019   7B00         MOV     R3,#0x0
   \   00001B   7914         MOV     R1,#0x14
   \   00001D   12....       LCALL   ??aps_FindGroup?relay
   \   000020   8B..         MOV     ?V0 + 1,R3
   \   000022   EA           MOV     A,R2
   \   000023   45..         ORL     A,?V0 + 1
   \   000025   600B         JZ      ??SampleApp_HandleKeys_2
    619              {
    620                // Remove from the group
    621                aps_RemoveGroup( SAMPLEAPP_ENDPOINT, SAMPLEAPP_FLASH_GROUP );
   \   000027                ; Setup parameters for call to function aps_RemoveGroup
   \   000027   7A01         MOV     R2,#0x1
   \   000029   7B00         MOV     R3,#0x0
   \   00002B   7914         MOV     R1,#0x14
   \   00002D   12....       LCALL   ??aps_RemoveGroup?relay
   \   000030   8009         SJMP    ??SampleApp_HandleKeys_1
    622              }
    623              else
    624              {
    625                // Add to the flash group
    626                aps_AddGroup( SAMPLEAPP_ENDPOINT, &SampleApp_Group );
   \                     ??SampleApp_HandleKeys_2:
   \   000032                ; Setup parameters for call to function aps_AddGroup
   \   000032   7A..         MOV     R2,#SampleApp_Group & 0xff
   \   000034   7B..         MOV     R3,#(SampleApp_Group >> 8) & 0xff
   \   000036   7914         MOV     R1,#0x14
   \   000038   12....       LCALL   ??aps_AddGroup?relay
    627              }
    628            }
    629          }
   \                     ??SampleApp_HandleKeys_1:
   \   00003B   7F02         MOV     R7,#0x2
   \   00003D   02....       LJMP    ?BANKED_LEAVE_XDATA
    630          
    631          /*********************************************************************
    632           * LOCAL FUNCTIONS
    633           */
    634          
    635          /*********************************************************************
    636           * @fn      SampleApp_MessageMSGCB
    637           *
    638           * @brief   Data message processor callback.  This function processes
    639           *          any incoming data - probably from other devices.  So, based
    640           *          on cluster ID, perform the intended action.
    641           *
    642           * @param   none
    643           *
    644           * @return  none
    645           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    646          void SampleApp_MessageMSGCB( afIncomingMSGPacket_t *pkt )
   \                     SampleApp_MessageMSGCB:
    647          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 15
   \   000005   74F1         MOV     A,#-0xf
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FE           MOV     R6,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FF           MOV     R7,A
    648          //  uint16 flashTime;  
    649                    Msg_Zg_WRT_transfer rpst;
    650          	  osal_memset(buf, 0, sizeof(buf));
   \   00000E                ; Setup parameters for call to function osal_memset
   \   00000E   7C40         MOV     R4,#0x40
   \   000010   7D00         MOV     R5,#0x0
   \   000012   7900         MOV     R1,#0x0
   \   000014   7A..         MOV     R2,#buf & 0xff
   \   000016   7B..         MOV     R3,#(buf >> 8) & 0xff
   \   000018   12....       LCALL   ??osal_memset?relay
    651          	  rpst.src_type = 1;				//for test
   \   00001B   85..82       MOV     DPL,?XSP + 0
   \   00001E   85..83       MOV     DPH,?XSP + 1
   \   000021   7401         MOV     A,#0x1
   \   000023   F0           MOVX    @DPTR,A
    652          	  rpst.len = pkt->cmd.DataLength;	//for test
   \   000024   EE           MOV     A,R6
   \   000025   241F         ADD     A,#0x1f
   \   000027   F8           MOV     R0,A
   \   000028   EF           MOV     A,R7
   \   000029   3400         ADDC    A,#0x0
   \   00002B   F9           MOV     R1,A
   \   00002C   E8           MOV     A,R0
   \   00002D   FA           MOV     R2,A
   \   00002E   E9           MOV     A,R1
   \   00002F   FB           MOV     R3,A
   \   000030   8A82         MOV     DPL,R2
   \   000032   8B83         MOV     DPH,R3
   \   000034   E0           MOVX    A,@DPTR
   \   000035   F8           MOV     R0,A
   \   000036   A3           INC     DPTR
   \   000037   E0           MOVX    A,@DPTR
   \   000038   F9           MOV     R1,A
   \   000039   740D         MOV     A,#0xd
   \   00003B   12....       LCALL   ?XSTACK_DISP0_8
   \   00003E   E8           MOV     A,R0
   \   00003F   F0           MOVX    @DPTR,A
   \   000040   A3           INC     DPTR
   \   000041   E9           MOV     A,R1
   \   000042   F0           MOVX    @DPTR,A
    653          	  rpst.end_dev_addr = pkt->srcAddr;	//for test
   \   000043   8E82         MOV     DPL,R6
   \   000045   8F83         MOV     DPH,R7
   \   000047   A3           INC     DPTR
   \   000048   A3           INC     DPTR
   \   000049   A3           INC     DPTR
   \   00004A   A3           INC     DPTR
   \   00004B   A3           INC     DPTR
   \   00004C   A3           INC     DPTR
   \   00004D   C082         PUSH    DPL
   \   00004F   C083         PUSH    DPH
   \   000051   7401         MOV     A,#0x1
   \   000053   12....       LCALL   ?XSTACK_DISP0_8
   \   000056   AC82         MOV     R4,DPL
   \   000058   AD83         MOV     R5,DPH
   \   00005A   D083         POP     DPH
   \   00005C   D082         POP     DPL
   \   00005E   740C         MOV     A,#0xc
   \   000060   12....       LCALL   ?MOVE_LONG8_XDATA_XDATA
    654          	  buflen = pack_msg_transfer(&rpst,pkt->cmd.Data,pkt->cmd.DataLength, buf);
   \   000063                ; Setup parameters for call to function pack_msg_transfer
   \   000063   75....       MOV     ?V0 + 0,#buf & 0xff
   \   000066   75....       MOV     ?V0 + 1,#(buf >> 8) & 0xff
   \   000069   78..         MOV     R0,#?V0 + 0
   \   00006B   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00006E   8A82         MOV     DPL,R2
   \   000070   8B83         MOV     DPH,R3
   \   000072   12....       LCALL   ?PUSH_XSTACK8_X_TWO
   \   000075   EE           MOV     A,R6
   \   000076   2421         ADD     A,#0x21
   \   000078   F582         MOV     DPL,A
   \   00007A   EF           MOV     A,R7
   \   00007B   3400         ADDC    A,#0x0
   \   00007D   F583         MOV     DPH,A
   \   00007F   E0           MOVX    A,@DPTR
   \   000080   FC           MOV     R4,A
   \   000081   A3           INC     DPTR
   \   000082   E0           MOVX    A,@DPTR
   \   000083   FD           MOV     R5,A
   \   000084   7404         MOV     A,#0x4
   \   000086   12....       LCALL   ?XSTACK_DISP0_8
   \   000089   AA82         MOV     R2,DPL
   \   00008B   AB83         MOV     R3,DPH
   \   00008D   12....       LCALL   ??pack_msg_transfer?relay
   \   000090   7404         MOV     A,#0x4
   \   000092   12....       LCALL   ?DEALLOC_XSTACK8
   \   000095   90....       MOV     DPTR,#buflen
   \   000098   EA           MOV     A,R2
   \   000099   F0           MOVX    @DPTR,A
   \   00009A   A3           INC     DPTR
   \   00009B   EB           MOV     A,R3
   \   00009C   F0           MOVX    @DPTR,A
    655          	  HalUARTWrite(0, (uint8*)buf, buflen);//串口发送
   \   00009D                ; Setup parameters for call to function HalUARTWrite
   \   00009D   90....       MOV     DPTR,#buflen
   \   0000A0   E0           MOVX    A,@DPTR
   \   0000A1   FC           MOV     R4,A
   \   0000A2   A3           INC     DPTR
   \   0000A3   E0           MOVX    A,@DPTR
   \   0000A4   FD           MOV     R5,A
   \   0000A5   7A..         MOV     R2,#buf & 0xff
   \   0000A7   7B..         MOV     R3,#(buf >> 8) & 0xff
   \   0000A9   7900         MOV     R1,#0x0
   \   0000AB   12....       LCALL   ??HalUARTWrite?relay
    656          	  HalLedSet(HAL_LED_3,HAL_LED_MODE_TOGGLE);
   \   0000AE                ; Setup parameters for call to function HalLedSet
   \   0000AE   7A08         MOV     R2,#0x8
   \   0000B0   7904         MOV     R1,#0x4
   \   0000B2   12....       LCALL   ??HalLedSet?relay
    657          	 // return;
    658                    /*
    659            switch ( pkt->clusterId )
    660            {
    661            	HalLedSet(HAL_LED_4,HAL_LED_MODE_TOGGLE);
    662              case SAMPLEAPP_PERIODIC_CLUSTERID:
    663                break;
    664          
    665              case SAMPLEAPP_FLASH_CLUSTERID:
    666                flashTime = BUILD_UINT16(pkt->cmd.Data[1], pkt->cmd.Data[2] );
    667                HalLedBlink( HAL_LED_4, 4, 50, (flashTime / 4) );
    668                break;
    669          	case SAMPLEAPP_R2C_CLUSTERID://
    670          	  
    671                break;
    672          	case SAMPLEAPP_C2R_CLUSTERID://收到协调器发给路由的数据
    673                HalUARTWrite(0, pkt->cmd.Data,  pkt->cmd.DataLength);//串口发送
    674                break;
    675            }
    676                    */
    677          }
   \   0000B5   740F         MOV     A,#0xf
   \   0000B7   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000BA   7F02         MOV     R7,#0x2
   \   0000BC   02....       LJMP    ?BANKED_LEAVE_XDATA
    678          
    679          
    680          

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    681          void SampleApp_SendFlashMessage(uint16 flashTime)
   \                     SampleApp_SendFlashMessage:
    682          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
    683          
    684          }
   \   000000   02....       LJMP    ?BRET

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for SampleApp_SimpleDesc>`:
   \   000000   14           DB 20
   \   000001   080F         DW 3848
   \   000003   0100         DW 1
   \   000005   00           DB 0
   \   000006   02           DB 2
   \   000007   ....         DW SampleApp_ClusterList
   \   000009   02           DB 2
   \   00000A   ....         DW SampleApp_ClusterList

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??AF_To_R_From_C?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    AF_To_R_From_C

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??Set_Zgb_param?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    Set_Zgb_param

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??Get_Zgb_param?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    Get_Zgb_param

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??SerialApp_CallBack?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SerialApp_CallBack

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??pack_msg_ack_param?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    pack_msg_ack_param

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??pack_msg_transfer?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    pack_msg_transfer

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??init_from_flash?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    init_from_flash

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??SampleApp_Init?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SampleApp_Init

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??SampleApp_ProcessEvent?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SampleApp_ProcessEvent

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??SampleApp_HandleKeys?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SampleApp_HandleKeys

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??SampleApp_MessageMSGCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SampleApp_MessageMSGCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??SampleApp_SendFlashMessage?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SampleApp_SendFlashMessage

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "Group 1">`:
   \   000000   47726F75     DB "Group 1"
   \            70203100

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "SampleApp">`:
   \   000000   53616D70     DB "SampleApp"
   \            6C654170
   \            7000    
    685          /*********************************************************************
    686          *********************************************************************/

   Maximum stack usage in bytes:

     Function                       ISTACK PSTACK XSTACK
     --------                       ------ ------ ------
     AF_To_R_From_C                     0      0     35
       -> AF_DataRequest                0      0     42
       -> HalLedBlink                   0      0     24
     Get_Zgb_param                      1      0     43
       -> osal_memset                   0      0     54
       -> osal_nv_read                  0      0     62
       -> pack_msg_ack_param            0      0     54
       -> HalUARTWrite                  0      0     54
     SampleApp_HandleKeys               0      0     22
       -> SampleApp_SendFlashMessage
                                        0      0     20
       -> aps_FindGroup                 0      0     20
       -> aps_RemoveGroup               0      0     20
       -> aps_AddGroup                  0      0     20
     SampleApp_Init                     0      0     50
       -> HalUARTOpen                   0      0     92
       -> osal_memset                   0      0     92
       -> osal_nv_read                  0      0    100
       -> afRegister                    0      0     92
       -> osal_memcpy                   0      0     98
       -> aps_AddGroup                  0      0     92
       -> HalLcdWriteString             0      0     92
     SampleApp_MessageMSGCB             2      0     41
       -> osal_memset                   0      0     50
       -> pack_msg_transfer             0      0     58
       -> HalUARTWrite                  0      0     50
       -> HalLedSet                     0      0     50
     SampleApp_ProcessEvent             0      0     12
       -> osal_msg_receive              0      0     24
       -> osal_stop_timerEx             0      0     24
       -> osal_msg_deallocate           0      0     24
       -> osal_msg_receive              0      0     24
       -> SampleApp_HandleKeys          0      0     24
       -> SampleApp_MessageMSGCB        0      0     24
       -> osal_start_timerEx            0      0     24
       -> HalLedSet                     0      0     24
       -> osal_start_timerEx            0      0     24
     SampleApp_SendFlashMessage         0      0     10
     SerialApp_CallBack                 0      0     16
       -> HalUARTRead                   0      0     24
       -> Calc_CRC8                     0      0     32
       -> AF_To_R_From_C                0      0     28
       -> Set_Zgb_param                 0      0     24
       -> Get_Zgb_param                 0      0     24
     Set_Zgb_param                      1      0     32
       -> osal_nv_item_init             0      0     36
       -> osal_nv_write                 0      0     40
     init_from_flash                    0      0     20
       -> osal_memset                   0      0     32
       -> osal_nv_read                  0      0     40
     pack_msg_ack_param                 1      0     51
       -> osal_memcpy                   0      0     46
       -> Calc_CRC8                     0      0     48
       -> osal_memcpy                   0      0     46
     pack_msg_transfer                  1      0     60
       -> osal_memcpy                   0      0     60
       -> osal_memcpy                   0      0     60
       -> Calc_CRC8                     0      0     62
       -> osal_memcpy                   0      0     60


   Segment part sizes:

     Function/Label                          Bytes
     --------------                          -----
     SampleApp_ClusterList                      4
     SampleApp_SimpleDesc                      12
     SampleApp_epDesc                           6
     SampleApp_TaskID                           1
     SampleApp_NwkState                         1
     globa_run_num                              1
     SampleApp_Group                           18
     uart_data_buffer                          50
     AF_To_R_From_C                            96
     Set_Zgb_param                            179
     Get_Zgb_param                            188
     SerialApp_CallBack                       149
     pack_msg_ack_param                       204
     pack_msg_transfer                        274
     init_from_flash                          128
     SampleApp_Init                           316
     buf                                       64
     buflen                                     2
     SampleApp_ProcessEvent                   193
     SampleApp_HandleKeys                      64
     SampleApp_MessageMSGCB                   191
     SampleApp_SendFlashMessage                 3
     ?<Initializer for SampleApp_SimpleDesc>   12
     ??AF_To_R_From_C?relay                     6
     ??Set_Zgb_param?relay                      6
     ??Get_Zgb_param?relay                      6
     ??SerialApp_CallBack?relay                 6
     ??pack_msg_ack_param?relay                 6
     ??pack_msg_transfer?relay                  6
     ??init_from_flash?relay                    6
     ??SampleApp_Init?relay                     6
     ??SampleApp_ProcessEvent?relay             6
     ??SampleApp_HandleKeys?relay               6
     ??SampleApp_MessageMSGCB?relay             6
     ??SampleApp_SendFlashMessage?relay         6
     ?<Constant "Group 1">                      8
     ?<Constant "SampleApp">                   10

 
 1 985 bytes in segment BANKED_CODE
    72 bytes in segment BANK_RELAYS
    12 bytes in segment XDATA_I
    12 bytes in segment XDATA_ID
    22 bytes in segment XDATA_ROM_C
   143 bytes in segment XDATA_Z
 
 2 069 bytes of CODE  memory
    22 bytes of CONST memory
   155 bytes of XDATA memory

Errors: none
Warnings: none
